"use strict";(async()=>{await eagle.preference.init(),await eagle.i18n.init();var e=new URL(location.href);let n=document.getElementById("autoscroll"),t=document.getElementById("board"),a=document.getElementById("logs"),o=0;if(e.searchParams.has("download")){const r=$("#exportLogMessage");r.find("h2").text(eagle.i18n.words["log-viewer.exporting-message"]),r.find("p").text(eagle.i18n.words["log-viewer.exporting-description"]),r.css("display","flex"),l(()=>{r.find("p").show(),setTimeout(()=>window.close(),5e3)})}else $("#main").css("display","flex");function i(e,o=!1){const i=new Intl.DateTimeFormat("ja-JP",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1});eagle.logger.all(n=>{let a="";for(let t=0;t<n.length;t++){if(n[t].time=i.format(n[t].time),a+=o?`<span class="line">${function(e,t,n){if(n.startsWith("[debug]")||n.startsWith("[DEBUG]"))return`[${e}] [${t}] <span style="color: red">${n}</span>`;if(n.startsWith('[background] {"method'))return`[${e}] [${t}] [background] <span style="color: #808080">${n.replace("[background] ","")}</span>`;if(n.startsWith("[background]"))return`[${e}] [${t}] <span style="color: #cfcfcf">${n}</span>`;if(n.startsWith("[content]"))return`[${e}] [${t}] <span style="color: #808080">${n}</span>`;return`[${e}] [${t}] `+n}(n[t].time,n[t].level,n[t].descriptor,n[t].data)}</span>`:`[${n[t].time}] [${n[t].level}] `+n[t].descriptor,null!=n[t].data){let e=JSON.stringify(n[t].data);150<=e.length&&(e=e.slice(0,150)+"..."),a+=e}a+=o?"\n<br>":"\n"}e(a)})}function l(e){e=e||(()=>{}),i(n=>{n=fflate.zipSync({"extension.log":fflate.strToU8(n)},{level:9});{var a="extension-log.zip",o;let e=new Blob([n],{type:"application/octet-stream"}),t=window.URL.createObjectURL(e);{var i=e;var l=a;let t=new FileReader;t.onload=()=>{var e=document.createElement("a");e.setAttribute("href",t.result),e.setAttribute("download",l),document.body.appendChild(e),e.click()},t.readAsDataURL(i)}setTimeout(()=>window.URL.revokeObjectURL(t),1e3)}e()})}$("#download").click(()=>{l()}),$(t).scroll(function(e){var t=$(this).scrollTop();t>o||(n.checked=!1),o=t}),$(document).on("click",".line",function(e){var t;t=$(this).text(),navigator.clipboard?navigator.clipboard.writeText(t).then(()=>{},e=>{}):fallbackCopyTextToClipboard(t)}),setInterval(()=>{2===eagle.logger.status()&&i(e=>{a.innerHTML=e,1==n.checked&&(t.scrollTop=t.scrollHeight)},!0)},800)})();