class BatchSaverItem{src;thumbnail;url;largeURL;domain;title;ext;width;height;type;duration;size;base64=null;constructor(t){this.id=eagle.crypto.generateUUID(),this.src=t.src,this.thumbnail=t.thumbnail||t.thumbnailURL||t.src,this.url=t.url,this.title=t.title,this.annotation=t.annotation,this.width=t.width,this.height=t.height,this.type=t.type,this.x=t.x,this.y=t.y,this.status="pending",this.updateResolution(),this.updateDomain(),this.ext=eagle.fileTypeDetector.simpleDetectExt(this.src)??"others"}async ready(t){var{url:i,largeUrl:e}=await eagle.enlargeProxy.enlarge(this.src);if(e?(this.src=e,this.thumbnail=i,this.status="pending",this.updateResolution(),t&&t(this)):this.status="done",await this.updateExt(),"jpeg"===this.ext&&(this.ext="jpg"),"image"===this.type)try{var s,h,a=await this.updateImageSize(this.src);if(a?.width&&a?.height&&({width:s,height:h}=a,this.width=s,this.height=h,this.updateResolution()),this.status="done",!this.ext)throw new Error("ext is null")}catch(t){this.status="pending",this.updateResolution(),window.parent.postMessage({channel:"batchSaver.convertUrlToBase64",src:this.src,thumbnailURL:this.thumbnail},"*")}else if("video"===this.type){const n=document.createElement("video");n.src=this.src,n.onloadedmetadata=()=>{this.width=n.videoWidth,this.height=n.videoHeight,this.duration=n.duration,this.status="done",this.updateResolution(),t&&t(this)},n.onerror=()=>{this.status="error",t&&t(this)}}this.updateResolution(),t&&t(this)}async updateImageSize(t){const e=new Image;return e.src=t,new Promise((t,i)=>{e.onload=()=>{this.width=e.width,this.height=e.height,t({width:e.width,height:e.height})},e.onerror=()=>{i()}})}updateResolution(){"pending"===this.status?this.size="pending":this.width&&this.height?1e3<=this.width||1e3<=this.height?this.size="large":500<=this.width||500<=this.height?this.size="medium":this.size="small":this.size="small"}async updateExt(){var t;this.ext&&"others"!==this.ext?this.ext=this.ext.toLowerCase():this.src.startsWith("data:image")?(this.type="image",this.ext=this.src.split(";")[0].split("/")[1],-1!==this.ext.indexOf("svg+xml")&&(this.ext="svg")):((t=await eagle.fileTypeDetector.detect(this.src)).ext&&(this.ext=t.ext),t.type&&(this.type=t.type))}updateDomain(){var t=new URL(this.src);this.domain=t.hostname||"none"}}