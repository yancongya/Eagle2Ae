angular.module("rectSelector",[]).directive("rectSelector",()=>({restrict:"E",scope:{onSelection:"&",onSelectionEnd:"&",selectionItems:"="},replace:!1,link:function(c,e,t){let i,r,s,u=!1;const h=angular.element(document.querySelector(t.container)),l=angular.element(document.body);function d(e){var t=h[0].getBoundingClientRect(),o=h[0].scrollLeft,n=h[0].scrollTop,o=e.clientX-t.left+o,t=e.clientY-t.top+n,n=Math.abs(o-i),l=Math.abs(t-r);!u&&(10<n||10<l)&&(u=!0,e.preventDefault(),f||((f=document.createElement("div")).id="rect",f.style.position="absolute",f.style.border="2px dashed rgb(0, 114, 239)",f.style.background="rgba(0, 114, 239, 0.1)",h[0].appendChild(f))),u&&(s.width=o-i,s.height=t-r,s.width<0?(s.x=o,s.width=Math.abs(s.width)):s.x=i,s.height<0?(s.y=t,s.height=Math.abs(s.height)):s.y=r,f&&(f.style.left=s.x+"px",f.style.top=s.y+"px",f.style.width=s.width+"px",f.style.height=s.height+"px"),c.$apply(()=>c.onSelection({items:m()})))}function a(e){u&&(f&&(f.remove(),f=null),c.$apply(()=>c.onSelectionEnd({event:e,items:m()}))),u=!1,l.off("mousemove.rectSelector",d),l.off("mouseup.rectSelector",a)}h.on("mousedown",function(e){var t,o,n;0===e.button&&(t=h[0].getBoundingClientRect(),o=h[0].scrollLeft,n=h[0].scrollTop,i=e.clientX-t.left+o,r=e.clientY-t.top+n,s={x:i,y:r,width:0,height:0},u=!1,l.on("mousemove.rectSelector",d),l.on("mouseup.rectSelector",a))});let f=null;function m(){return c.selectionItems.filter(e=>{var t=s.x,o=s.y,n=s.x+s.width,l=s.y+s.height,c=e.x,i=e.y,r=e.x+e.width,e=e.y+e.height;return c<n&&t<r&&i<l&&o<e})}e.on("$destroy",function(){h.off("mousedown",null),l.off("mousemove.rectSelector",d),l.off("mouseup.rectSelector",a)})}}));