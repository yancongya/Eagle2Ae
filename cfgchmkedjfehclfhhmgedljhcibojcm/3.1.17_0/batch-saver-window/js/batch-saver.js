class BatchSaver{supportExts=["jpg","png","webp","avif","bmp","gif","mp4","webm","svg","others"];supportSizes=["large","medium","small","pending"];disabledDomainMap={};isLoading=!0;keyword="";groups=[];rawItems=[];rawItemsMap={};items=[];selectedItems={};temporarySelectedItems={};vsGridItems=[];vsGridState={};vsGridRepeatOptions={columnWidth:175,columnHeight:175,columnGap:8,rowGap:12,extraRange:2e3,groupLabelHeight:0,squareMode:!0,listMode:!1,paddingTop:0,paddingBottom:12,paddingLeft:12,paddingRight:12};expandState={resolution:"false"!==localStorage["eagle.batchSaver.expandState.resolution"]??!0,format:"false"!==localStorage["eagle.batchSaver.expandState.format"]??!0,domain:"false"!==localStorage["eagle.batchSaver.expandState.domain"]??!0,folder:"false"!==localStorage["eagle.batchSaver.expandState.folder"]??!0,tag:"false"!==localStorage["eagle.batchSaver.expandState.tag"]??!0};constructor(){this.resetFilter()}get itemsCount(){return this.rawItems.length}get selectedItemsCount(){return Object.keys(this.selectedItems).length}update(){this.updateFilter(),this.updateFormatResolutionAvailableCounts(),this.calculateResult(),this.isLoading=!1}async addItems(e){for(var t of e)this.rawItemsMap[t.src]||(this.rawItemsMap[t.src]=t,this.rawItems.push(t));this.updateFilter(),this.calculateResult()}removeItem(e){var t=this.rawItems.indexOf(e);-1!==t&&this.rawItems.splice(t,1),delete this.rawItemsMap[e.src],this.updateFilter(),this.calculateResult()}resetTemporarySelectedItems(){this.temporarySelectedItems={}}addTemporarySelectedItem(e){this.temporarySelectedItems[e.id]=e}toggleSection(e){this.expandState[e]=!this.expandState[e],localStorage["eagle.batchSaver.expandState."+e]=this.expandState[e]}async toggleItem(e){let t=1;this.selectedItems[e.id]?(delete this.selectedItems[e.id],t=-1):this.selectedItems[e.id]=e,this.filter.format.selected[e.ext]+=t,this.filter.resolution.selected[e.size]+=t,this.filter.domain.selected[e.domain]+=t}selectItem(e){this.selectedItems[e.id]||(this.selectedItems[e.id]=e,this.filter.format.selected[e.ext]++,this.filter.resolution.selected[e.size]++,this.filter.domain.selected[e.domain]++)}resetSelectedItems(){this.selectedItems={},Object.entries(this.filter.format.selected).forEach(e=>{var[e,,]=e;this.filter.format.selected[e]=0}),Object.entries(this.filter.resolution.selected).forEach(e=>{var[e,,]=e;this.filter.resolution.selected[e]=0}),Object.entries(this.filter.domain.selected).forEach(e=>{var[e,,]=e;this.filter.domain.selected[e]=0})}changeKeyword(e){this.keyword=e,this.calculateResult()}onCustomizeFilterChange(){localStorage["eagle.batchSaver.filter.customize.minWidth"]=this.filter.resolution.customize.minWidth,localStorage["eagle.batchSaver.filter.customize.minHeight"]=this.filter.resolution.customize.minHeight,localStorage["eagle.batchSaver.filter.customize.maxWidth"]=this.filter.resolution.customize.maxWidth,localStorage["eagle.batchSaver.filter.customize.maxHeight"]=this.filter.resolution.customize.maxHeight,this.calculateResult(),this.updateFormatResolutionAvailableCounts()}selectAll(){this.items.forEach(e=>{this.selectedItems[e.id]||(this.selectedItems[e.id]=e,this.filter.format.selected[e.ext]++,this.filter.resolution.selected[e.size]++,this.filter.domain.selected[e.domain]++)})}selectOpposite(){this.items.forEach(e=>{this.selectedItems[e.id]?(delete this.selectedItems[e.id],this.filter.format.selected[e.ext]--,this.filter.resolution.selected[e.size]--,this.filter.domain.selected[e.domain]--):(this.selectedItems[e.id]=e,this.filter.format.selected[e.ext]++,this.filter.resolution.selected[e.size]++,this.filter.domain.selected[e.domain]++)})}zoomIn(){var e=document.querySelector("#grid-container").clientWidth,t=this.vsGridRepeatOptions.columnGap,i=this.vsGridRepeatOptions.columnWidth;let l=Math.floor((e+t)/(i+t))-1;i=(e-((l=l<1?1:l)-1)*t)/l;this.vsGridRepeatOptions.columnWidth=i-10}zoomOut(){var e=document.querySelector("#grid-container").clientWidth,t=this.vsGridRepeatOptions.columnGap,i=this.vsGridRepeatOptions.columnWidth,i=Math.floor((e+t)/(i+t))+1;this.vsGridRepeatOptions.columnWidth=(e-(i-1)*t)/i-10}zoomDefault(){this.vsGridRepeatOptions.columnWidth=175}toggleFilter(e,t){this.filter[e].enabled[t]?delete this.filter[e].enabled[t]:this.filter[e].enabled[t]=!0,"resolution"===e&&(localStorage["eagle.batchSaver.filter.enable.resolution-"+t]=!!this.filter[e].enabled[t]),"domain"===e&&(this.disabledDomainMap[t]=!this.filter[e].enabled[t]),this.calculateResult(),this.updateFormatResolutionAvailableCounts()}toggleCustomizeResolution(){this.filter.resolution.enabled.customize?(this.filter.resolution.enabled.customize=!1,Object.keys(this.filter.resolution.enabled).forEach(e=>{"customize"!==e&&(this.filter.resolution.enabled[e]=!0)})):(this.filter.resolution.enabled.customize=!0,Object.keys(this.filter.resolution.enabled).forEach(e=>{"customize"!==e&&(this.filter.resolution.enabled[e]=!1)})),this.calculateResult(),this.updateFormatResolutionAvailableCounts()}resetFilter(){this.filter={format:{available:{},selected:{},enabled:{}},resolution:{available:{},selected:{},enabled:{customize:!1},customize:{minWidth:localStorage["eagle.batchSaver.filter.customize.minWidth"]?parseInt(localStorage["eagle.batchSaver.filter.customize.minWidth"]):0,minHeight:localStorage["eagle.batchSaver.filter.customize.minHeight"]?parseInt(localStorage["eagle.batchSaver.filter.customize.minHeight"]):0,maxWidth:localStorage["eagle.batchSaver.filter.customize.maxWidth"]?parseInt(localStorage["eagle.batchSaver.filter.customize.maxWidth"]):0,maxHeight:localStorage["eagle.batchSaver.filter.customize.maxHeight"]?parseInt(localStorage["eagle.batchSaver.filter.customize.maxHeight"]):0}},domain:{available:{},selected:{},enabled:{}}},this.supportExts.forEach(e=>{this.filter.format.available[e]=0,this.filter.format.selected[e]=0,this.filter.format.enabled[e]=!0}),this.supportSizes.forEach(e=>{this.filter.resolution.available[e]=0,this.filter.resolution.selected[e]=0,this.filter.resolution.enabled[e]="false"!==localStorage["eagle.batchSaver.filter.enable.resolution-"+e]}),this.rawItems.forEach(e=>{e=e.domain;void 0===this.filter.domain.available[e]&&(this.filter.domain.available[e]=0,this.filter.domain.selected[e]=0,this.filter.domain.enabled[e]=!this.disabledDomainMap[e])})}updateFilter(){this.resetFilter(),this.rawItems.forEach(e=>{e.ext&&(void 0!==this.filter.format.available[e.ext]?this.filter.format.available[e.ext]++:this.filter.format.available.others++),e.size&&(this.filter.resolution.available[e.size]=this.filter.resolution.available[e.size]||0,this.filter.resolution.available[e.size]++),e.domain&&(this.filter.domain.available[e.domain]=this.filter.domain.available[e.domain]||0,this.filter.domain.available[e.domain]++)})}updateFormatResolutionAvailableCounts(){Object.entries(this.filter.resolution.available).forEach(e=>{var[e,,]=e;this.filter.resolution.available[e]=0}),Object.entries(this.filter.format.available).forEach(e=>{var[e,,]=e;this.filter.format.available[e]=0}),Object.entries(this.filter.domain.available).forEach(e=>{var[e,,]=e;this.filter.domain.available[e]=0});let e=this.rawItems;e=e.filter(this.filterWithFormat.bind(this));var t=this.filter.resolution.enabled.large||this.filter.resolution.enabled.medium||this.filter.resolution.enabled.small||this.filter.resolution.enabled.pending;let i=this.rawItems.filter(this.filterWithCustomizeResolution.bind(this)),l=(t&&(i=i.filter(this.filterWithResolution.bind(this))),this.rawItems);l=l.filter(this.filterWithFormat.bind(this)),i.forEach(e=>{e.ext&&(void 0!==this.filter.format.available[e.ext]?this.filter.format.available[e.ext]++:this.filter.format.available.others++)}),e.forEach(e=>{e.size&&(this.filter.resolution.available[e.size]=this.filter.resolution.available[e.size]||0,this.filter.resolution.available[e.size]++)}),l.forEach(e=>{e.domain&&(this.filter.domain.available[e.domain]=this.filter.domain.available[e.domain]||0,this.filter.domain.available[e.domain]++)})}filterWithKeyword(e){var t=this.keyword.toLowerCase(),i=e.title.toLowerCase(),e=e.ext;return i.includes(t)||e.includes(t)}filterWithFormat(e){return this.filter.format.enabled[e.ext]}filterWithResolution(e){return this.filter.resolution.enabled[e.size]}filterWithCustomizeResolution(e){var t,i,l,a,s;return!(this.filter.resolution.enabled.customize&&({width:e,height:t}=e,{minWidth:i,minHeight:l,maxWidth:a,maxHeight:s}=this.filter.resolution.customize,i&&e<i||l&&t<l||a&&a<e||s&&s<t))}filterWithDomain(e){return!!Object.values(this.filter.domain.enabled).some(e=>1==e)&&this.filter.domain.enabled[e.domain]}calculateResult(){let e=this.rawItems;var t=Object.values(this.filter.format.enabled).some(e=>1==e),i=this.filter.resolution.enabled.large||this.filter.resolution.enabled.medium||this.filter.resolution.enabled.small||this.filter.resolution.enabled.pending;this.keyword&&(e=e.filter(this.filterWithKeyword.bind(this))),e=(e=t?e.filter(this.filterWithFormat.bind(this)):e).filter(this.filterWithCustomizeResolution.bind(this)),e=(e=(e=i?e.filter(this.filterWithResolution.bind(this)):e).filter(this.filterWithDomain.bind(this))).sort((e,t)=>e.size===t.size?e.y===t.y?e.x-t.x:e.y-t.y:this.supportSizes.indexOf(e.size)-this.supportSizes.indexOf(t.size)),this.items=e,this.items.forEach((e,t)=>{e.index=t}),this.groups=[{id:"group-all",name:"all",items:[...this.items]}]}}