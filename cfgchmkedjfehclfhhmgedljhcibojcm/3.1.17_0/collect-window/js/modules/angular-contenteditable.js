angular.module("contenteditable",[]).directive("contenteditable",["$timeout",function(e){return{restrict:"A",require:"?ngModel",link:function(e,r,n,o){function i(e){e=e.replace(/(\b(https?|ftp):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/gim,'<a href="$1" target="_blank">$1</a>');return e=(e=e.replace(/(^|[^\/])(www\.[\S]+(\b|$))/gim,'$1<a href="http://$2" target="_blank">$2</a>')).replace(/(([a-zA-Z0-9\-\_\.])+@[a-zA-Z\_]+?(\.[a-zA-Z]{2,6})+)/gim,'<a href="mailto:$1">$1</a>')}function c(e){return e.replace(/<div>/g,"").replace(/<br>/g,"").replace(/<\/div>/g,"").replace(/(\r\n|\n|\r)/g,"")}var d,l;e.$on("$destroy",function(){r.find("a").off("click")}),o&&(d={},angular.forEach(["stripBr","noLineBreaks","selectNonEditable","moveCaretToEndOnChange","stripTags","allowLink","plaintextOnly"],function(e){var t=n[e];d[e]=t&&"false"!==t}),n.maxlength&&(d.maxlength=parseInt(n.maxlength)),r.on("keydown",function(e){27===e.keyCode&&(e.stopPropagation(),e.preventDefault())}),r.on("blur",function(e){var t,n=d.plaintextOnly?r[0].innerText:r.html(),a=n,l=!1;d.stripBr&&(n=n.replace(/<br>$/,"")),d.noLineBreaks&&(t=c(n))!==n&&(l=!0,n=t),n&&n.replaceAll&&(n=n.replaceAll("&amp;","&")),o.$setViewValue(n),a===n||!l&&n.length===i(n)||o.$render()}),r.on("keydown",function(e){d.maxlength&&r.html().length>=d.maxlength&&8!==e.keyCode&&e.preventDefault()}),r.on("paste",function(e){var t=r.html();let n=e.originalEvent.clipboardData.getData(d.plaintextOnly?"text/plain":"text/html");d.noLineBreaks&&(n=c(n)),!d.maxlength||t.length+n.length<=d.maxlength?(e.preventDefault(),document.execCommand(d.plaintextOnly?"insertText":"insertHTML",!1,n)):e.preventDefault()}),r.on("keydown",function(e){d.noLineBreaks&&13===e.keyCode&&e.preventDefault()}),l=o.$render,o.$render=function(){l&&l();var e,t,n,a=o.$viewValue||"";!new RegExp(/<\/?[b-z\d][^>]*>/gi).test(a)&&(a=a.replace(/<\S[^><]*>/g,""),d.allowLink)?(a=i(a),r.html(a)):r.text(a),d.moveCaretToEndOnChange&&(a=r[0],t=document.createRange(),n=window.getSelection(),0<a.childNodes.length?(e=a.childNodes[a.childNodes.length-1],t.setStartAfter(e)):t.setStartAfter(a),t.collapse(!0),n.removeAllRanges(),n.addRange(t))},d.selectNonEditable)&&r.bind("click",function(e){var t,n,e=e.toElement;e!==this&&"false"===angular.element(e).attr("contenteditable")&&(t=document.createRange(),n=window.getSelection(),t.setStartBefore(e),t.setEndAfter(e),n.removeAllRanges(),n.addRange(t))})}}}]);