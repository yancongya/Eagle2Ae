EagleApp.directive("librarySwitcher",["$timeout",a=>({restrict:"E",templateUrl:"js/directives/library-switcher.html",replace:!0,scope:{theme:"=theme",onLibrarySwitching:"=",onLibrarySwitched:"=",onLibrarySwitchClosed:"="},link:(t,a,r)=>{t.updateLibrary=async()=>{var a=await eagle.library.info();t.currentLibrary=a.library||{name:"",path:""},t.$evalAsync()},t.updateLibrary(),a.on("click",async a=>{const e=(await eagle.library.info()).library.path;var r=await eagle.library.history();ContextMenu.open({showSearch:!0,items:[...r.map(r=>{var a=(a=(i=r).match(/([^\/]+)\.library$/))?a[1]:i.split("/").pop(),i=(r.replace(/[^/]+\.library$/,""),"http://localhost:41595/api/library/icon?libraryPath="+encodeURIComponent(r));return{label:a,disabled:r===e,checked:r===e,image:i,fallbackImage:"/images/base/icons/default-library-icon.png",click:async()=>{t.onLibrarySwitching();let a=r;await eagle.library.switchPromise(r).catch(()=>{a=e}).finally(()=>{t.updateLibrary(),t.onLibrarySwitched({libraryPath:a})})}}})],onClosed:()=>{t.onLibrarySwitchClosed(),t.$evalAsync()}})})}})]);