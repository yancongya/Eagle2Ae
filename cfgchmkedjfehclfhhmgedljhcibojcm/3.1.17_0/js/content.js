"use strict";(async()=>{function e(){$("[eagle-extension]").attr("eagle-extension-theme",eagle.preference.displayTheme),$("[eagle-extension]").attr("eagle-extension-locale",eagle.preference.getPreferredLocale()),$("[eagle-extension]").attr("eagle-extension-os",eagle.env.os.name),$("[eagle-extension]").attr("eagle-browser",eagle.env.browser.name),eagle.collectWindow.updateTheme()}await eagle.env.isDOMReady(),await eagle.preference.init(),e(),await eagle.i18n.init(),await eagle.shortcuts.init(),new DragSaver({onDrop:async e=>{var{folderID:e,extendTags:a,element:t}=e,l=await eagle.elementInspector.getMeta(t,{parseBase64:!0}),n=eagle.siteParser.getMeta(),{url:i,largeUrl:r}=eagle.preference.downloadViaBrowser?await eagle.urlEnlarger.enlargeWithoutCheckEagleHasAbility(l.src):await eagle.urlEnlarger.enlarge(l.src);l.src=r||i;let o={...n,...l,behavior:"drag",type:"image"};o.tags=[...o.tags||[],...a||[]],eagle.env.shouldShowNewCollectWindow(e)?(r=await eagle.utils.getElementDimensions(t),eagle.collectWindow.open({type:l.elementType,width:r.width,height:r.height,src:l.src,title:l.title,annotation:l.annotation,tags:l.tags,onCollect:e=>{eagle.item.addFile({...o,...e})}})):(e&&("choose"===e?o.forceOpenCollectModal=!0:(o.forceHideCollectModal=!0,o.folderID=e)),eagle.item.addFile(o))}}),new ContextSaver({onSave:async e=>{var a=await eagle.elementInspector.getMeta(e,{parseBase64:!0}),t=eagle.siteParser.getMeta(),{url:l,largeUrl:n}=eagle.preference.downloadViaBrowser?await eagle.urlEnlarger.enlargeWithoutCheckEagleHasAbility(a.src):await eagle.urlEnlarger.enlarge(a.src);a.src=n||l;let i={...t,...a,behavior:"context",type:"image"};eagle.env.shouldShowNewCollectWindow()?(n=await eagle.utils.getElementDimensions(e),eagle.collectWindow.open({type:a.elementType,width:n.width,height:n.height,src:a.src,title:a.title,annotation:a.annotation,tags:a.tags,onCollect:e=>{eagle.item.addFile({...i,...e})}})):eagle.item.addFile(i)}}),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",({})=>{e()}),eagle.preference.changed(()=>{e()}),eagle.env.isChrome&&(window.dispatchEvent(new CustomEvent("CheckEagleExtensionEvent")),window.addEventListener("CheckEagleExtensionEvent",function(e){eagle.dialog.showMultipleEagleExtensionRunningDialog()}))})();