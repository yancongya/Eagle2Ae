class TagSelectPanelItem{id=null;name=null;color=null;size=26;group=null;groupName=null;groups=[];groupsMap={};pinyin=null;imageCount=0;isRecent=!1;isStarred=!1;isSuggestion=!1;index=null;constructor(t){var{id:t,name:e,type:s,color:a,size:i,group:r,groupName:l,groups:o,groupsMap:n,pinyin:h,imageCount:g,isRecent:p,isStarred:u,isSuggestion:d,index:c}=t;try{this.isInit=!1,this.id=t?.replace(/\\/g,"_")??"",this.name=e??"",this.type=s??null,this.color=a??null,this.size=i??26,this.group=r??null,this.groupName=l??null,this.groups=o??[],this.groupsMap=n??{},this.pinyin=h??"",this.imageCount=g??0,this.isRecent=p??!1,this.isStarred=u??!1,this.isSuggestion=d??!1,this.index=c??null}catch(t){}}}class TagSelectPanel extends SelectPanel{TAG_TYPE={TAG:"tag",CREATE:"create"};GROUP_ID={NONE:"none",SELECTED:"group-selected",STARRED:"group-starred",HISTORY:"group-history",SUGGEST:"group-suggest",NORMAL:"group-normal"};height=localStorage["eagle.tagsPopup.height"]??480;width=localStorage["eagle.tagsPopup.width"]??320;isPined=!1;isOpenSettings=!1;isOpened=!1;groups=[];originalParams;searchKeyword;rawData;onChanged;onAdd;onRemove;pinSelected=!0;isShowCount="false"!==localStorage["eagle.tagsPopup.isShowCount"]??!0;isShowSidebar="true"===localStorage["eagle.tagsPopup.isShowSidebar"]??!1;isShowRecentTags="false"!==localStorage.getItem("eagle.tagsPopup.isShowRecentTags")??!0;isShowStarredTags="false"!==localStorage.getItem("eagle.tagsPopup.isShowStarredTags")??!0;isShowSuggestedTags="false"!==localStorage.getItem("eagle.tagsPopup.isShowSuggestedTags")??!0;vsGridLayoutColumnSizes={xsmall:100,small:120,medium:140,large:160};vsGridRepeatOptions={paddingTop:8,paddingBottom:8,paddingLeft:8,paddingRight:8,columnWidth:this.vsGridLayoutColumnSizes[localStorage["eagle.tagsPopup.columnSize"]]??140,columnHeight:26,columnGap:2,rowGap:2,extraRange:500,groupLabelHeight:36,squareMode:!1,listMode:"true"===localStorage.getItem("eagle.tagsPopup.listMode")||!1,onScrollStart:()=>{this.$panel.find("select-panel-list").addClass("scrolling")},onScrollEnd:()=>{this.$panel.find("select-panel-list").removeClass("scrolling")}};vsGridItems=[];vsGridState={};columnSize=localStorage["eagle.tagsPopup.columnSize"]??"small";static open(t){angular.element("html").scope().$broadcast("TAG.SELECT.PANEL.OPEN",t)}constructor(t){super(t)}open(){this.$panel.css({width:this.width+"px",height:this.height+"px"}),super.open()}init(t){this.originalParams=t,super.init(t),this.pinSelected=t.pinSelected??!0,this.reset(),this.initRawData(t),this.onChanged=t.onChanged||(()=>{}),this.onAdd=t.onAdd||(()=>{}),this.onRemove=t.onRemove||(()=>{}),this.showCreateTagBtn=t.showCreateTagBtn??!0,this.updateItemList()}reset(){super.reset(),this.isInit=!1,this.listData.selectedTags={},this.listData.groups=[],this.rawData={tags:[],tagItemsMap:{},tagGroups:[],tagGroupsMap:{},selectedTags:{}}}initRawData(t){this.isInit=!1,this.rawData={tagManager:t.tagManager,tags:angular.copy(t.tagManager.allTags)||[],tagItemsMap:{},tagGroups:angular.copy(t.tagManager.groups)||[],tagGroupsMap:{},tagGroupsIndexMap:{},selectedTags:t.selectedTags||{},recentTagsMap:{},starredTagsMap:{}},this.rawData.tagGroupsMap.none={},this.rawData.tagGroups.forEach((t,e)=>{this.rawData.tagGroupsMap[t.id]=t,this.rawData.tagGroupsIndexMap[t.id]=e}),this.rawData.tags.forEach(t=>{var{name:t,pinyin:e,groups:s,imageCount:a}=t,i=s[0],r=s.reduce((t,e)=>(t[e]=!0,t),{}),i=(i||(r.none=!0),new TagSelectPanelItem({type:this.TAG_TYPE.TAG,id:t,name:t,color:i?this.rawData.tagGroupsMap?.[i]?.color:void 0,size:26,group:i||"none",groupName:null,groups:s,groupsMap:r,pinyin:e,imageCount:a,isRecent:!1,isStarred:!1,index:null}));this.rawData.tagItemsMap[t]=i}),Object.keys(this.rawData.selectedTags).forEach(t=>{var e;this.rawData.tagItemsMap[t]||(e=new TagSelectPanelItem({type:this.TAG_TYPE.TAG,id:t,name:t,color:void 0,size:26,group:"none",groupName:null,groups:[],groupsMap:{none:!0},imageCount:0,isRecent:!1,isStarred:!1,index:null}),this.rawData.tagItemsMap[t]=e,this.rawData.tags.push(e))});let s=1;var e=t.tagManager.recentTags.filter(t=>void 0!==this.rawData.tagItemsMap[t]).slice(0,12).reduce((t,e)=>(t[e]=s++,t),{});this.rawData.recentTagsMap=e,this.rawData.starredTagsMap={},t.tagManager?.starredTags?.forEach(t=>{this.rawData.starredTagsMap[t]=!0}),this.listData.selectedTags={...this.rawData.selectedTags},this.listData.tagGroups=this.rawData.tagGroups,this.listData.tagGroupsCountMap={},this.updateTagsState(),this.isInit=!0}updateTagsState(){let r=[];let l={};this.rawData.tagManager.suggestions=this.rawData.tagManager.suggestions||[],this.rawData.tags.forEach(t=>{var e=t["name"],s=this.rawData.tagItemsMap[e],{recentTagsMap:a,starredTagsMap:i}=this.rawData;s.isSuggestion||l[e]||(t=new TagSelectPanelItem({id:s.id,type:s.type,isExist:s.isExist,name:s?.name??t,color:s?.color??void 0,size:26,index:s.index,group:s?.group??"none",groupName:s?.groupName??null,groups:s?.groups??void 0,groupsMap:s?.groupsMap??{},pinyin:s.pinyin,imageCount:s.imageCount,isRecent:a[e],isStarred:i[e],isSuggestion:l[e]}),r.push(t))}),this.rawData.suggestionTags=[],this.rawData.tagItems=r}updateItemList(){this.resetListData();let t=this.rawData.tagItems;const s=this.listData.searchKeyword;var a=this.showCreateTagBtn&&""!==s&&!this.rawData.tags.some(t=>t.name===s),i=(t=(t=this.isShowSuggestedTags&&0<this.rawData.suggestionTags.length?[...this.rawData.suggestionTags,...t]:t).sort((t,e)=>{if(t.isStarred&&!e.isStarred)return-1;if(!t.isStarred&&e.isStarred)return 1;if(t.isRecent&&e.isRecent){if(this.rawData.recentTagsMap[t.name]<this.rawData.recentTagsMap[e.name])return-1;if(this.rawData.recentTagsMap[t.name]>this.rawData.recentTagsMap[e.name])return 1}if(t.isSuggestion&&!e.isSuggestion)return-1;if(!t.isSuggestion&&e.isSuggestion)return 1;if(t.isRecent&&!e.isRecent)return-1;if(!t.isRecent&&e.isRecent)return 1;var s=t.name,a=e.name,t="none"!==t.group?t.group:void 0,e="none"!==e.group?e.group:void 0;if(t===e){if(s<a)return-1;if(a<s)return 1}a=this.rawData.tagGroupsIndexMap[t],s=this.rawData.tagGroupsIndexMap[e];return!t&&e?1:t&&!e||a<s?-1:s<a?1:0}),[...t=this.filterByKeyword(t)]),i=(this.listData.tagGroupsCountMap={},this.listData.tagGroupsCountMap.all=i.length,i.forEach(t=>{Object.keys(t.groupsMap).forEach(t=>{void 0===this.listData.tagGroupsCountMap[t]&&(this.listData.tagGroupsCountMap[t]=0),this.listData.tagGroupsCountMap[t]++})}),t=this.filterByGroup(t),document.querySelector("[ng-app]")),i=angular.element(i).injector().get("$filter")("i18n"),r=(this.GROUP_ID.SELECTED,i("selectTagPanel.label.selected"),{id:this.GROUP_ID.STARRED,items:[],isCollapsed:!1,name:i("selectTagPanel.label.starred")}),l={id:this.GROUP_ID.HISTORY,items:[],isCollapsed:!1,name:i("selectTagPanel.label.recent")},o={id:this.GROUP_ID.SUGGEST,items:[],isCollapsed:!1,name:i("selectTagPanel.label.recommend")};let n={id:this.GROUP_ID.NORMAL,items:[],isCollapsed:!1,name:i("selectTagPanel.label.others")},h={};i=this.rawData.tagGroups.map(t=>{var e={id:t.id,name:t.name,color:t.color,isCollapsed:!1,items:[]};return h[t.id]=e});let g=[],p=[],u=[],d=[];if(t.forEach((t,e)=>{t.type===this.TAG_TYPE.TAG&&(t.isRecent||t.isSuggestion||t.isStarred?t.isStarred?(this.isShowStarredTags?d:u).push(t):t.isRecent?(this.isShowRecentTags?g:u).push(t):t.isSuggestion&&(this.isShowSuggestedTags?p:u).push(t):u.push(t))}),0<d.length&&(r.items=[...d]),0<g.length&&(l.items=[...g]),0<p.length&&(o.items=[...p]),0<u.length&&u.forEach(t=>{(h[t.group]?.items?h[t.group]:n).items.push(t)}),s){let e=[];a&&e.push(new TagSelectPanelItem({id:"create-"+encodeURIComponent(s),type:this.TAG_TYPE.CREATE,size:26,name:s})),this.isShowStarredTags&&0<d.length&&Array.prototype.push.apply(e,r.items),this.isShowRecentTags&&0<g.length&&Array.prototype.push.apply(e,l.items),this.isShowSuggestedTags&&0<p.length&&Array.prototype.push.apply(e,o.items),e.forEach((t,e)=>{t.index=e,t.groupName="group-default"}),i.forEach(t=>{0<t.items.length&&Array.prototype.push.apply(e,t.items)}),0<n.items.length&&Array.prototype.push.apply(e,n.items),this.listData.groups=[{id:"group-default",items:e}],this.listData.groups[0].items=this.sortByKeywordSimilarity(this.listData.groups[0].items,s),this.listData.groupsMap["group-default"]=this.listData.groups[0],this.listData.currentGroup=this.listData.groups[0]}else this.listData.groups=[],this.isShowStarredTags&&0<r.items.length&&this.listData.groups.push(r),this.isShowRecentTags&&0<l.items.length&&this.listData.groups.push(l),this.isShowSuggestedTags&&0<o.items.length&&this.listData.groups.push(o),i.forEach(t=>{0<t.items.length&&this.listData.groups.push(t)}),0<n.items.length&&this.listData.groups.push(n),this.listData.currentGroup=this.listData.groups.find(t=>!t.isCollapsed)??this.listData.groups[0];this.listData.groups.forEach(s=>{s.isCollapsed="true"===localStorage["eagle.tagsPopup.collapsedGroup."+s.id]||!1,s.items.forEach((t,e)=>{t.index=e,t.groupName=s.id}),this.listData.groupsMap[s.id]=s}),this.decideDefaultSelectedItem(),this.decideLayoutMode(),this.render()}resetListData(){this.listData.currentIndex=-1,this.listData.currentGroup=null,this.listData.currentItem=null,this.listData.groups=[],this.listData.groupsMap={}}decideDefaultSelectedItem(){var t;""!==this.listData.searchKeyword?(t=this.listData.currentGroup.items.find(t=>t.type!==this.TAG_TYPE.CREATE))&&t.name.toLowerCase&&t.name.toLowerCase().startsWith(this.listData.searchKeyword.toLowerCase())?this.listData.currentIndex=t.index:0<this.listData.currentGroup.items.length?this.listData.currentIndex=0:this.listData.currentIndex=-1:this.listData.currentIndex=-1,this.listData.currentItem=this.listData.currentGroup?.items?.[this.listData.currentIndex]}decideLayoutMode(){var t=this.vsGridRepeatOptions;1===this.listData.groups.length&&1===this.listData.groups[0].items.length?t.listMode=!0:t.listMode="true"===localStorage.getItem("eagle.tagsPopup.listMode")||!1}filterByGroup(t){return this.listData.sidebarGroup?.id&&this.isShowSidebar?t.filter(t=>{try{return t.groupsMap[this.listData.sidebarGroup.id]}catch(t){return!1}}):t}filterByKeyword(t){if(0!==this.listData.searchKeyword.length){const s=chineseConvert.tw2cn(this.listData.searchKeyword),a=this.listData.searchKeyword.toLowerCase();var e=t.filter(t=>{return!(this.listData.searchKeyword.length<2||!(t=this.rawData.tagGroupsMap[t.groups?.[0]])?.name)&&0<=t.name.toLowerCase().indexOf(a)});t=[...t=t.map(t=>{var e=chineseConvert.tw2cn(t.name);return 30<=t.name.length?{item:t,name:e,search:[e]}:{item:t,name:e,search:[e,...new Set(cartesianProduct(pinyinlite(e,{keepUnrecognized:!0}).filter(t=>0<t.length)).map(t=>t.join(" ")))]}}).map(t=>{return{item:t,name:`${t.name??""} `+(t.keywords??""),score:Math.max(...t.search.map(t=>t.score(s)))}}).filter(t=>0<t.score).map(t=>t.item.item),...e],t=[...new Set(t)]}return t}sortByKeywordSimilarity(t,r){function l(t,e){if(function(t,e){var s,t=new Set(t),a=new Set(e);for(s of t)if(a.has(s))return 1}(t,e)){var s=t,a=e,i=[];for(let t=0;t<=a.length;t++)i[t]=[t];for(let t=0;t<=s.length;t++)i[0][t]=t;for(let e=1;e<=a.length;e++)for(let t=1;t<=s.length;t++)a.charAt(e-1)===s.charAt(t-1)?i[e][t]=i[e-1][t-1]:i[e][t]=Math.min(i[e-1][t-1]+1,i[e][t-1]+1,i[e-1][t]+1);return i[a.length][s.length]}return 1/0}return t.sort((t,e)=>{var s,a=t.type===this.TAG_TYPE.CREATE,i=e.type===this.TAG_TYPE.CREATE;return a&&!i?-1:!a&&i?1:(a=t.name,i=e.name,t=a.toLowerCase(),e=i.toLowerCase(),t===(a=r.toLowerCase())?-1:e===a?1:(i=t.includes(a),s=e.includes(a),i&&!s?-1:!i&&s?1:i&&s?t.indexOf(a)-e.indexOf(a):l(a,t)-l(a,e)))})}getCallbackResult(){var t,s,e;return t=this.rawData.selectedTags,s=this.listData.selectedTags,t=Object.entries(t),e=Object.entries(s),{isDirty:!(t.length===e.length&&t.every(([t,e])=>s[t]===e)),selectedTags:{...this.listData.selectedTags},deselectedTags:Object.entries(this.rawData.selectedTags).reduce((t,[e])=>(this.listData.selectedTags[e]||(t[e]=!0),t),{})}}close(){var t;this.isOpenSettings?this.closeSettings():(this.onChanged&&(t=this.getCallbackResult()).isDirty&&this.onChanged(t),super.close(),this.reset())}selectGroup(t){this.listData.sidebarGroup="none"===t?{id:"none"}:t,this.updateItemList()}onPaste(e){var s=clipboard.readText();if(s){let t=this.parseTags(s);1<t.length&&(e.preventDefault(),e.stopPropagation(),t=(t=(t=(t=t.slice(0,200)).map(t=>t.trim())).filter(t=>t&&0<t.trim().length)).reverse(),this.createdTags(t),this.onAdd(t))}}hoverItem(t,e){var s=t.clientX,t=t.clientY,a=windowMouseX,i=windowMouseY;0!==Math.sqrt(Math.pow(s-a,2)+Math.pow(t-i,2))&&(this.listData.currentItem=e,this.listData.currentIndex=e.index,this.listData.currentGroup=this.listData.groupsMap[e.group])}autoScroll(){this.listData?.currentItem?.id&&this.scrollToItem(this.listData.currentItem.id)}selectPreviousGroup(){const e=this.listData.currentGroup;var t=this.listData.groups;const s=t.findIndex(t=>t.id===e.id);t=t.find((t,e)=>!t.isCollapsed&&e<s);t&&(this.listData.currentGroup=t,this.listData.currentIndex=t.items.length-1,this.listData.currentItem=t.items[this.listData.currentIndex]),this.autoScroll()}selectNextGroup(){const e=this.listData.currentGroup;var t=this.listData.groups;const s=t.findIndex(t=>t.id===e.id);t=t.find((t,e)=>!t.isCollapsed&&e>s);t&&(this.listData.currentGroup=t,this.listData.currentIndex=0,this.listData.currentItem=t.items[this.listData.currentIndex]),this.autoScroll()}selectUp(){if(this?.listData?.currentGroup?.isCollapsed)return this.selectPreviousGroup();var t=parseInt(this.$panel.find("select-panel-list").attr("columns"));const e=this.listData.currentGroup;var s=this.listData.currentIndex,a=e.items,i=s%t,s=(Math.floor(s/t)-1)*t+i;0<=s?(this.listData.currentIndex=s,this.listData.currentItem=a[s]):0<=(s=(a=this.listData.groups.filter(t=>!t.isCollapsed)).findIndex(t=>t.id===e.id)-1)&&a[s]&&(s=(a=a[s]).items.length,t=Math.floor((s-1)/t)*t+i,this.listData.currentIndex=t<s?t:s-1,this.listData.currentGroup=a,this.listData.currentItem=a.items[this.listData.currentIndex]),this.autoScroll()}selectDown(){if(this?.listData?.currentGroup?.isCollapsed)return this.selectNextGroup();var t=parseInt(this.$panel.find("select-panel-list").attr("columns"));const e=this.listData.currentGroup;var s=this.listData.currentIndex,a=e.items,i=a.length,r=this.listData.groups.length,l=Math.ceil(i/t),o=s%t,s=Math.floor(s/t)+1,t=s*t+o;-1==t?(this.listData.currentIndex=0,this.listData.currentGroup=this.listData.groups[0],this.listData.currentItem=this.listData.currentGroup.items[this.listData.currentIndex]):t<i?(this.listData.currentIndex=t,this.listData.currentItem=a[t]):s<l?(this.listData.currentIndex=i-1,this.listData.currentItem=a[this.listData.currentIndex]):(s=(t=this.listData.groups.filter(t=>!t.isCollapsed)).findIndex(t=>t.id===e.id)+1)<r&&t[s]&&(o<(l=t[s]).items.length?this.listData.currentIndex=o:this.listData.currentIndex=0,this.listData.currentGroup=l,this.listData.currentItem=l.items[this.listData.currentIndex]),this.autoScroll()}selectLeft(){if(this?.listData?.currentGroup?.isCollapsed)return this.selectPreviousGroup();const a=this.listData.currentGroup;var t=this.listData.currentIndex,t=a.items[t-1];const i=this.listData.groups.filter(t=>!t.isCollapsed);var e=i.reduce((t,e,s)=>t=e.id===a.id&&i[s-1]?i[s-1]:t,void 0);t?(this.listData.currentIndex=t.index,this.listData.currentItem=t,this.listData.currentGroup=a):(e?(this.listData.currentGroup=e,this.listData.currentIndex=e.items.length-1):this.listData.currentIndex=0,this.listData.currentItem=this.listData.currentGroup.items[this.listData.currentIndex]),this.autoScroll()}selectRight(){if(this?.listData?.currentGroup?.isCollapsed)return this.selectNextGroup();const a=this.listData.currentGroup;var t=this.listData.currentIndex,t=a.items[t+1];if(t)this.listData.currentIndex=t.index,this.listData.currentItem=t,this.listData.currentGroup=a;else{const i=this.listData.groups.filter(t=>!t.isCollapsed);t=i.reduce((t,e,s)=>t=e.id===a.id&&i[s+1]?i[s+1]:t,void 0);t&&(this.listData.currentGroup=t,this.listData.currentIndex=0,this.listData.currentItem=this.listData.currentGroup.items[this.listData.currentIndex])}this.autoScroll()}onTabKey(t){var t=t.shiftKey,e=[void 0,...this.rawData.tagGroups.map(t=>t.id),"none"],s=this.listData.sidebarGroup?.id,s=e.indexOf(s),t=t?e[(s-1)%e.length]:e[(s+1)%e.length];this.listData.sidebarGroup="none"===t?{id:"none"}:this.rawData.tagGroupsMap[t],this.updateItemList()}openItem(t){var e,s,a=this.listData.currentItem,t=t?.ctrlKey||t?.metaKey;a&&(a.type===this.TAG_TYPE.CREATE?(e=this.parseTags(this.listData.searchKeyword),this.createdTags(e),this.onAdd(e)):a.type===this.TAG_TYPE.TAG&&(e=a.name,(s=this.listData.selectedTags)[e]?(this.onRemove([e]),delete s[e],delete this.rawData.recentTagsMap[e]):(this.onAdd([e]),s[e]=!0,this.rawData.tagItemsMap[e]||(this.rawData.tagItemsMap[e]=a,this.rawData.tags.push(a))),""===this.listData.searchKeyword||t||(this.listData.searchKeyword="",this.clearSearchInput(),this.updateItemList())))}scrollTop(){this.$panel.find("select-panel-list").scrollTop(0),this.$panel.find("select-panel-list").trigger("render")}render(){this.$panel.find("select-panel-list").trigger("render")}keywordChanged(){this.updateItemList(),setTimeout(()=>{this.scrollTop()},50)}scrollToGroup(e){var t=this.vsGridItems.find(t=>t.id===e)?.y;void 0!==t&&this.$panel.find("select-panel-list").scrollTop(t)}scrollToItem(e){function t(h,e,g=500){new Promise((a,t)=>{"number"!=typeof(e="string"==typeof e?document.querySelector(e)||t():e)&&(e=e.getBoundingClientRect().top+h.scrollTop);let i=h.scrollTop,r=e-i,l=0,o=20;const n=()=>{l+=o;t=l,e=i,s=r;var t,e,s=(t/=g/2)<1?s/2*t*t+e:-s/2*(--t*(t-2)-1)+e;h.scrollTop=s,l<g?setTimeout(n,o):a()};n()})}var s,a,i=this.$panel.find("select-panel-list"),r=this.vsGridItems.find(t=>t.id===e);r&&(s=r.y,r=r.height,r=(a=i.scrollTop())<=s&&s+r<=a+i.height(),a=s-i.height()/2,r||t(i[0],a,100))}createdTags(t){if(0!==t.length){t=t.map(t=>t.trim()||t),t=(t=[...new Set(t)].reverse()).slice(0,200);let r={...this.listData.selectedTags};const l=this.rawData.tagGroupsMap[this?.listData?.sidebarGroup?.id];t.forEach(t=>{var e,s,a,i;this.rawData.tagItemsMap[t]?r[t]=!0:(e=l?l.id:"none",i=l?l.color:void 0,a=(s=l?[l.id]:[]).reduce((t,e)=>(t[e]=!0,t),{}),l||(a.none=!0),i=new TagSelectPanelItem({type:this.TAG_TYPE.TAG,id:t,name:t,color:i,size:26,group:e,groups:s,groupsMap:a,imageCount:0,isRecent:!0}),this.rawData.tagItemsMap[t]=i,this.rawData.tags.push(i),r[t]=!0,Object.keys(this.rawData.recentTagsMap).forEach(t=>{this.rawData.recentTagsMap[t]+=1}),this.rawData.recentTagsMap[t]=1)}),this.listData.searchKeyword="",this.listData.selectedTags=r,this.clearSearchInput(),this.updateTagsState(),this.updateItemList()}}parseTags(t){try{return t.split(/[，,;、\n]+/).filter(t=>0<t.trim().length)}catch(t){return[]}}toggleGroup(t){var e=this.listData.groupsMap[t];e.isCollapsed=!e.isCollapsed,e.isCollapsed?localStorage["eagle.tagsPopup.collapsedGroup."+t]=e.isCollapsed:localStorage.removeItem("eagle.tagsPopup.collapsedGroup."+t),this.render()}toggleAllGroups(t){const e=!this.listData.groupsMap[t].isCollapsed;this.listData.groups.forEach(t=>{(t.isCollapsed=e)?localStorage["eagle.tagsPopup.collapsedGroup."+t.id]=t.isCollapsed:localStorage.removeItem("eagle.tagsPopup.collapsedGroup."+t.id)}),this.render()}toggleSidebar(){this.listData.sidebarGroup=void 0,this.isShowSidebar=!this.isShowSidebar,this.updateItemList(),localStorage["eagle.tagsPopup.isShowSidebar"]=this.isShowSidebar}toggleCount(){this.isShowCount=!this.isShowCount,localStorage["eagle.tagsPopup.isShowCount"]=this.isShowCount}toggleSuggestedTags(){this.isShowSuggestedTags=!this.isShowSuggestedTags,this.updateItemList(),localStorage["eagle.tagsPopup.isShowSuggestedTags"]=this.isShowSuggestedTags}toggleRecentTags(){this.isShowRecentTags=!this.isShowRecentTags,this.updateItemList(),localStorage["eagle.tagsPopup.isShowRecentTags"]=this.isShowRecentTags}toggleStarredTags(){this.isShowStarredTags=!this.isShowStarredTags,this.updateItemList(),this.render(),localStorage["eagle.tagsPopup.isShowStarredTags"]=this.isShowStarredTags}setColumnSize(t){this.vsGridRepeatOptions.columnWidth=this.vsGridLayoutColumnSizes[t],localStorage["eagle.tagsPopup.columnSize"]=t}openSettings(){this.isOpenSettings=!this.isOpenSettings}closeSettings(){this.isOpenSettings=!1}setListMode(t){this.vsGridRepeatOptions.listMode=t,localStorage["eagle.tagsPopup.listMode"]=t}}angular.module("tagSelectPanel",[]).directive("tagSelectPanel",["$timeout",i=>({restrict:"E",templateUrl:"/js/directives/tag-select-panel.html",replace:!1,scope:{theme:"=theme"},link:(s,t)=>{const e=$(t).find(".select-panel"),a=new TagSelectPanel({showCreateTagBtn:!1,fixedSize:!0,scope:s,panelSelector:"tag-select-panel .tag-select-panel",searchInputSelector:"tag-select-panel .panel-header input"});s.$on("TAG.SELECT.PANEL.OPEN",(t,e)=>{i(()=>{a.init(e),s.panel=a,s.listData=a.listData},10),i(()=>{a.open({preventCollisionWithElement:e.preventCollisionWithElement})},0)});{let s={};e.draggable({scroll:!1,distance:5,containment:"body",start:(t,e)=>{s={height:e.helper.outerHeight(),width:e.helper.outerWidth()}},stop:()=>{e.height(s.height),e.width(s.width),a.fixedSize=!0}})}e.resizable({maxWidth:800,minWidth:200,minHeight:160,maxHeight:640,containment:"body",handles:"n, e, s, w, ne, se, sw, nw",stop:(t,e)=>{var s=e.element.innerHeight(),e=e.element.innerWidth();localStorage.setItem("eagle.tagsPopup.height",s),localStorage.setItem("eagle.tagsPopup.width",e),a.height=s,a.width=e,a.fixedSize=!0}})}})]);