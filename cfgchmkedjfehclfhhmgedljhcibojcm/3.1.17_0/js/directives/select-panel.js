"use strict";String.prototype.score=function(e,t){if(this===e)return 1;if(""===e)return 0;var s,n,i,o,h=0,a=this,r=a.toLowerCase(),l=a.length,c=e.toLowerCase(),p=e.length,u=0,d=1;if(t&&(i=1-t),t)for(o=0;o<p;o+=1)-1===(n=r.indexOf(c[o],u))?d+=i:(u===n?s=.7:(s=.1," "===a[n-1]&&(s+=.8)),a[n]===e[o]&&(s+=.1),h+=s,u=n+1);else for(o=0;o<p;o+=1){if(-1===(n=r.indexOf(c[o],u)))return 0;u===n?s=.7:(s=.1," "===a[n-1]&&(s+=.8)),a[n]===e[o]&&(s+=.1),h+=s,u=n+1}return t=.5*(h/l+h/p)/d,c[0]===r[0]&&t<.85&&(t+=.15),t};class SelectPanelSearchInput{enterKeydown;$input;onChange;onEnterKey;onEscKey;onTabKey;onUpKey;onDownKey;onLeftKey;onRightKey;onPaste;constructor(e){this.$input=$(e.selector),this.onChange=e.onChange||function(){},this.onEnterKey=e.onEnterKey||function(){},this.onEscKey=e.onEscKey||function(){},this.onTabKey=e.onTabKey||function(){},this.onUpKey=e.onUpKey||function(){},this.onDownKey=e.onDownKey||function(){},this.onLeftKey=e.onLeftKey||function(){},this.onRightKey=e.onRightKey||function(){},this.onPaste=e.onPaste||function(){},this.enterKeydown=!1,this.escKeydown=!1,this.$input.off("keyup").on("keyup",e=>{switch(e.keyCode){case 13:this.enterKeydown&&(this.onEnterKey(e),this.enterKeydown=!1);break;case 27:this.escKeydown&&(e.preventDefault(),e.stopPropagation(),this.onEscKey(),this.escKeydown=!1)}}),this.$input.off("keydown").on("keydown",e=>{switch(e.keyCode){case 9:void 0!==this.onTabKey&&(e.preventDefault(),e.stopPropagation(),this.onTabKey(e));break;case 13:e.preventDefault(),e.metaKey||e.ctrlKey?this.onEnterKey(e):this.enterKeydown=!0;break;case 37:this.onLeftKey(e);break;case 39:this.onRightKey(e);break;case 38:e.preventDefault(),this.onUpKey();break;case 40:e.preventDefault(),this.onDownKey();break;case 27:e.preventDefault(),this.escKeydown=!0}}),this.$input.off("paste").on("paste",e=>{this.onPaste(e)}),this.$input.off("input").on("input",e=>{this.onChange()})}focus(){this.$input.focus()}blur(){this.$input.blur()}}class SelectPanel{fixedSize;searchInput;searchKeyword;listData;$panel;onOpened;onClosed;onSelectChanged;scope;constructor(e){this.scope=e.scope,this.$panel=$(e.panelSelector),this.onSelectChanged=e.onSelectChanged||(()=>{}),this.fixedSize=e.fixedSize??!1,this.searchInput=new SelectPanelSearchInput({scope:e.scope,selector:e.searchInputSelector,onChange:()=>{this.listData.searchKeyword=this.searchInput.$input.val(),this.keywordChanged(),this.scope.$evalAsync()},onEnterKey:e=>{var t=this.listData?.items?.[this.listData.currentIndex];this.openItem(e,t),this.scope.$evalAsync()},onEscKey:()=>{this.close(),this.scope.$evalAsync()},onTabKey:e=>{this.onTabKey(e),this.scope.$evalAsync()},onUpKey:e=>{this.selectUp(e),this.scope.$evalAsync()},onDownKey:e=>{this.selectDown(e),this.scope.$evalAsync()},onLeftKey:e=>{this.selectLeft&&this.selectLeft(e),this.onLeftKey&&this.onLeftKey(e),this.scope.$evalAsync()},onRightKey:e=>{this.selectRight&&this.selectRight(e),this.onRightKey&&this.onRightKey(e),this.scope.$evalAsync()},onPaste:e=>{this.onPaste(e),this.scope.$evalAsync()}})}init(e){this.reset(),this.panelHeight=this.$panel.height(),this.onOpened=e.onOpened||(()=>{}),this.onClosed=e.onClosed||(()=>{})}reset(){this.listData||(this.listData={items:[],currentIndex:-1,searchKeyword:""}),this.listData.items=[],this.listData.currentIndex=-1,this.listData.searchKeyword="",this.clearSearchInput()}open(e){e?.preventCollisionWithElement?this.#moveToCursorPositionAndPreventCollisionWithElement(()=>{this.$panel.addClass("open"),this.onOpened&&this.onOpened(),setTimeout(()=>{this.searchInput.focus()},50)},e.preventCollisionWithElement,0):this.#moveToCursorPosition(()=>{this.$panel.addClass("open"),this.onOpened&&this.onOpened(),setTimeout(()=>{this.searchInput.focus()},50)},0)}close(){this.scrollTop(),this.$panel.removeClass("open"),this.searchInput.blur(),this.reset(),this.onClosed()}selectUp(){var e,t;0<this.listData.currentIndex&&(e=this.listData.currentIndex-1,t=this.listData.items[e])&&(this.listData.currentIndex=e,this.onSelectChanged({index:this.listData.currentIndex,item:this.listData.items[this.listData.currentIndex],type:"keyboard"}),this.isItemSelectable(t)||this.selectUp())}selectDown(){var e,t;this.listData.currentIndex<this.listData.items.length-1&&(e=this.listData.currentIndex+1,t=this.listData.items[e])&&(this.listData.currentIndex=e,this.onSelectChanged({index:this.listData.currentIndex,item:this.listData.items[this.listData.currentIndex],type:"keyboard"}),this.isItemSelectable(t)||this.selectDown())}openItem(e,t){throw new Error("You have to implement the method doSomething!")}onTabKey(){}onPaste(){}hoverItem(e){this.listData.currentIndex=e,this.onSelectChanged({index:this.listData.currentIndex,item:this.listData.items[this.listData.currentIndex],type:"mouse"})}focusSearchInput(){this.searchInput.focus()}clearSearchInput(){this.searchInput.$input.val("")}keywordChanged(){throw new Error("You have to implement the method doSomething!")}isItemSelectable(e){throw new Error("You have to implement the method doSomething!")}scrollTop(){this.$panel.find("select-panel-list").scrollTop(0)}#moveToCursorPositionAndPreventCollisionWithElement(e,t,s){var n,i,o=$(window).width(),h=$(window).height(),a=this.$panel.width(),r=this.$panel.height();let l=windowMouseX+10,c=windowMouseY-10;s<3&&r===this.panelHeight?setTimeout(()=>{this.#moveToCursorPositionAndPreventCollisionWithElement(e,t,s+1)},50):(windowMouseX+a>o&&(l=windowMouseX-a-20),windowMouseY+r>h-20&&(c=(c=h-r-20)<20?20:c),t&&(i=(n=t.getBoundingClientRect()).top+n.height,n=n.left+n.width,l<n)&&c<i&&((i=i+10)+r<=h-20?c=i:(r=n+10)+a<=o-20&&(l=r)),this.$panel.css({left:l+"px",top:c+"px"}),e())}#moveToCursorPosition(e,t){var s=$(window).width(),n=$(window).height(),i=this.$panel.width(),o=this.$panel.height();let h=windowMouseX+10,a=windowMouseY-10;!this.fixedSize&&t<30&&o===this.panelHeight?setTimeout(()=>{this.#moveToCursorPosition(e,t+1)},5):(windowMouseX+i>s&&(h=windowMouseX-i-20),windowMouseY+o>n-20?a=(a=n-o-20)<20?20:a:windowMouseY-56<0&&(a=36),s=n-a-80,this.$panel.css({left:h+"px",top:a+"px"}),this.$panel.find("select-panel-list").css({"max-height":s-40+"px"}),e())}}function cartesianProduct(a,r){var l,c;if(r=r||10,Array.isArray(a))return l=a.length-1,c=[],a.length?function e(t,s){for(var n=a[s],i=s===l,o=0;o<n.length;++o){var h=t.slice();if(h.push(n[o]),r<=c.length)break;i?c.push(h):e(h,s+1)}}([],0):c.push([]),c;throw new TypeError}