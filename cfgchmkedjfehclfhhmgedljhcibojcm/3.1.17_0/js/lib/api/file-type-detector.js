class ForegroundFileTypeDetector{simpleDetectExt(e){return this.getExtensionFromURL(e)}static SUPPORTED_EXTENSIONS=new Set(["jpg","jpeg","png","gif","svg","webp","avif","mp4","webm"]);getExtensionFromURL(e){var t;if(!e?.startsWith("data:image"))return[e,t]=e.split("?"),e=e?.split("/").pop(),this.#extractExtensionFromFileName(e)||(t?this.getExtension(t):void 0)}#extractExtensionFromFileName(e){return e&&e.includes(".")&&(e=e.split(".").pop()?.toLowerCase())&&ForegroundFileTypeDetector.SUPPORTED_EXTENSIONS.has(e)?e:void 0}getExtension(e){return-1<(e=e.toLowerCase()).indexOf("png")?"png":-1<e.indexOf("avif")?"avif":-1<e.indexOf("jpg")||-1<e.indexOf("jpeg")?"jpg":-1<e.indexOf("svg")?"svg":-1<e.indexOf("webp")?"webp":-1<e.indexOf("gif")?"gif":-1<e.indexOf("mp4")?"mp4":-1<e.indexOf("webm")?"webm":void 0}async detect(e){return this.#sendBackgroundDetect(e)}async#sendBackgroundDetect(e){e=await eagle.runtime.sendMessage("detect",{url:e});if(e.error)throw new Error(e.error);return e}}class BackgroundFileTypeDetector{#TIMEOUT=2e4;constructor(){eagle.runtime.onMessage("detect",async(i,e,n)=>{try{let e=null,t=null;var r=i.url;if(!r)return n();var o,s,a,d=await fetch(r),p=d.headers.get("content-type")||"",g=d.headers.get("content-disposition")||"";"application/octet-stream"===p&&(o=await d.blob(),s=this.getContentDispositionType(g),t=s.type?(e=s.type,s.ext):(a=await this.getBlobMimeType(o),e=a.split("/")[0],this.getExtension(a))),(p.includes("image/")||p.includes("video/"))&&(e=p.split("/")[0],t=p.split("/")[1]),n({ext:t,type:e})}catch(e){}return!0})}getExtension(e){return-1<(e=e.toLowerCase()).indexOf("png")?"png":-1<e.indexOf("avif")?"avif":-1<e.indexOf("jpg")||-1<e.indexOf("jpeg")?"jpg":-1<e.indexOf("svg")?"svg":-1<e.indexOf("webp")?"webp":-1<e.indexOf("gif")?"gif":-1<e.indexOf("mp4")?"mp4":-1<e.indexOf("webm")?"webm":void 0}async getBlobMimeType(i){return new Promise((r,t)=>{var e=new FileReader;e.onloadend=function(e){var t=new Uint8Array(e.target.result).subarray(0,16);let i="";for(let e=0;e<t.length;e++)i+=t[e].toString(16).padStart(2,"0");i=i.toLowerCase();let n="unknown";n=i.includes("ffd8ffe0")||i.includes("ffd8ffe1")||i.includes("ffd8ffe2")||i.includes("ffd8ffe3")?"image/jpeg":i.includes("89504e47")?"image/png":i.includes("47494638")?"image/gif":i.includes("52494646")?"image/webp":i.includes("41564946")?"image/avif":i.includes("66747970")?"video/mp4":i.includes("1a45dfa3")?"video/webm":"application/octet-stream",r(n)},e.onerror=function(e){t(e)},e.readAsArrayBuffer(i.slice(0,16))})}getContentDispositionType(e){return-1<(e=e.toLowerCase()).indexOf(".mp4")?{type:"video",ext:"mp4"}:-1<e.indexOf(".webm")?{type:"video",ext:"webm"}:-1<e.indexOf(".png")?{type:"image",ext:"png"}:-1<e.indexOf(".avif")?{type:"image",ext:"avif"}:-1<e.indexOf(".jpg")?{type:"image",ext:"jpg"}:-1<e.indexOf(".jpeg")?{type:"image",ext:"jpeg"}:-1<e.indexOf(".svg")?{type:"image",ext:"svg"}:-1<e.indexOf(".webp")?{type:"image",ext:"webp"}:-1<e.indexOf(".gif")?{type:"image",ext:"gif"}:{}}}class FileTypeDetector{#detector;constructor(){!eagle.env.isBackground()||eagle.env.isPopup()||eagle.env.isCollectWindow()||eagle.env.isBatchSaverWindow()?this.#detector=new ForegroundFileTypeDetector:this.#detector=new BackgroundFileTypeDetector}async detect(e){return this.#detector.detect(e)}simpleDetectExt(e){return this.#detector.simpleDetectExt(e)}}eagle.fileTypeDetector=new FileTypeDetector;