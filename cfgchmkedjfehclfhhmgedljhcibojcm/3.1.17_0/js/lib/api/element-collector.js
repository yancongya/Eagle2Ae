class ElementCollector{async getCollectableItems(){var e=this.#getBgImageElements(),t=this.#getImagesElements(),n=this.#getSVGsElements(),a=this.#getVideosElements(),r=[];for(const l of[...e,...t,...n,...a])try{var s=await eagle.elementInspector.getMeta(l.element,{context:"batchSaver"});l.element.closest("[eagle-extension]")||(s.src||l?.elementMeta.src)&&r.push({...l,elementMeta:s})}catch(e){}return r}async getIframeCollectableItems(){return new Promise(t=>{if(0===[...document.querySelectorAll("iframe")].filter(e=>9e4<e.clientWidth*e.clientWidth).length)return t([]);chrome.runtime.sendMessage({channel:"batch-save-iframe"},e=>{try{return e?.data&&0<e?.data.length?t(...e.data):t([])}catch(e){return t([])}})})}async getShadowRootCollectableItems(){return new Promise(async e=>{var t=[];for(const a of function(e){let a=[];return function t(e,n){e.shadowRoot&&t(e.shadowRoot,!0),n&&"IMG"===e.tagName&&e.src&&a.push({element:e,src:e.src}),Array.from(e.children).forEach(e=>{t(e,n)})}(e,!1),a}(document.documentElement))try{var n=await eagle.elementInspector.getMeta(a.element,{context:"batchSaver"});t.push({type:"image",element:a.element,elementMeta:n})}catch(e){}return e(t)})}#getImagesElements(){let s=[];return $("img").each((e,t)=>{var n=t.currentSrc||t.getAttribute("src"),a=t.naturalWidth,r=t.naturalHeight;a&&r&&(a<5||r<5)||n&&s.push({type:"image",width:parseInt(a),height:parseInt(r),element:t})}),s}#getSVGsElements(){let r=[];return $("svg").each((e,t)=>{var n=t.viewBox?.baseVal?.width||t.width?.baseVal?.value||t.clientWidth,a=t.viewBox?.baseVal?.height||t.height?.baseVal?.value||t.clientHeight;t.width<5||t.height<5||r.push({type:"svg",width:parseInt(n),height:parseInt(a),src:(e=>{e=(new XMLSerializer).serializeToString(e);return"data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(e)))})(t),element:t})}),r}#getVideosElements(){let i=[];return $("video").each((e,n)=>{const a=n.videoWidth,r=n.videoHeight,s=n.currentSrc||n.src||"";if(n.duration&&!s.startsWith("blob:")){var t=$(n).find("source");const l=["video/mp4","video/webm"];0<t.length?t.each((e,t)=>{s==t.src&&l.includes(t.type)&&i.push({type:"video",width:parseInt(a),height:parseInt(r),duration:n.duration,element:n})}):[".mp4",".webm"].some(e=>s.includes(e))&&i.push({type:"video",width:parseInt(a),height:parseInt(r),duration:n.duration,element:n})}}),i}#getBgImageElements(){var e=[...document.querySelectorAll("body, body *")];let a=[];return e.forEach(e=>{var t,n=$(e).css("background-image");n&&"none"!==n&&-1===n.indexOf("gradient")&&({width:n,height:t}=e.getBoundingClientRect(),n<5||t<5||a.push({type:"bg-image",width:parseInt(n),height:parseInt(t),element:e}))}),a}}eagle.elementCollector=new ElementCollector;