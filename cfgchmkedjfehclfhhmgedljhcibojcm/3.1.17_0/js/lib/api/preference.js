class Preference{#id="";#dirty={shortcut:!1,locale:!1};#onChangeCallbacks=[];#onReadyCallbacks=[];keybindings={};#userPreferences={theme:"light",overrideLocale:"browser",dragMode:1,dragEnable:!0,urlBlackList:[],domainBlackList:[],shortcutsSettings:{macOS:{"url-save":"Alt + 0","batch-save":"Alt + 1","capture-area":"Alt + 2","capture-visible":"Alt + 3","capture-entire":"Alt + 4"},Windows:{"url-save":"Alt + 0","batch-save":"Alt + 1","capture-area":"Alt + 2","capture-visible":"Alt + 3","capture-entire":"Alt + 4"}},usingCollect:!1,useRetina:!1,captureDelay:.5,captureFormat:"png",agreePrivacyPolicy:!1,downloadViaBrowser:!1};get displayTheme(){return"system"===this.#userPreferences.theme?eagle.env.browserTheme:this.#userPreferences.theme}get dragMode(){return this.#userPreferences.dragMode}set dragMode(e){this.#userPreferences.dragMode=e}get dragEnable(){return this.#userPreferences.dragEnable}set dragEnable(e){this.#userPreferences.dragEnable=e}get theme(){return this.#userPreferences.theme}set theme(e){["light","dark","system"].includes(e)&&(this.#userPreferences.theme=e)}get overrideLocale(){return this.#userPreferences.overrideLocale}set overrideLocale(e){this.#userPreferences.overrideLocale!==e&&(this.#dirty.locale=!0,this.#userPreferences.overrideLocale=e)}get urlBlackList(){return this.#userPreferences.urlBlackList}set urlBlackList(e){this.#userPreferences.urlBlackList=e}get domainBlackList(){return this.#userPreferences.domainBlackList}set domainBlackList(e){this.#userPreferences.domainBlackList=e}get shortcutsSettings(){return this.#userPreferences.shortcutsSettings}get usingCollect(){return this.#userPreferences.usingCollect}set usingCollect(e){this.#userPreferences.usingCollect=e}get useRetina(){return this.#userPreferences.useRetina}set useRetina(e){this.#userPreferences.useRetina=e}get captureDelay(){return this.#userPreferences.captureDelay||.5}set captureDelay(e){e=parseFloat(e),eagle.env.isChrome?e<.5&&(e=.5):e<.3&&(e=.3),this.#userPreferences.captureDelay=e||.5}get captureFormat(){return this.#userPreferences.captureFormat}set captureFormat(e){this.#userPreferences.captureFormat=e}get agreePrivacyPolicy(){return this.#userPreferences.agreePrivacyPolicy}set agreePrivacyPolicy(e){this.#userPreferences.agreePrivacyPolicy=e}get downloadViaBrowser(){return this.#userPreferences.downloadViaBrowser&&eagle.env.isAppSupportDownloadViaBrowser}set downloadViaBrowser(e){this.#userPreferences.downloadViaBrowser=e}async init(){this.#id=eagle.crypto.generateUUID(),this.#registerRuntimeChannel(),await this.#initPreference(),this.#onReadyCallbacks.forEach(e=>{e()})}updateKeybindings(e){this.#dirty.shortcut=!0,this.#userPreferences.shortcutsSettings[eagle.env.os.name]=e}#registerRuntimeChannel(){eagle.runtime.onMessage("preference-changed",async(r,e,t)=>{var s=r.senderID;return this.#id!==s&&(await this.#initPreference(),this.#onChangeCallbacks.forEach(e=>{e(r)})),t(),!0})}changed(e){this.#onChangeCallbacks.push(e)}ready(e){this.#onReadyCallbacks.push(e)}getPreferredLocale(){return"browser"===this.#userPreferences.overrideLocale?navigator.language:this.#userPreferences.overrideLocale}async#initPreference(){await eagle.env.isEagleOpen();try{var e=Object.keys(this.#userPreferences);const r=await eagle.storage.sync.get(e);r.shortcutsSettings&&(r.shortcutsSettings=JSON.parse(r.shortcutsSettings)),e.forEach(e=>{void 0!==r[e]&&(this.#userPreferences[e]=r[e])})}catch(e){}this.#userPreferences.usingCollect=eagle.env.appInfo?.showCollectModal||!1,this.#dirty={shortcut:!1,locale:!1},this.#updateShortcut()}async save(){await this.#storePreference(),await this.#broadcastUpdateSettings()}async#storePreference(){var e={...this.#userPreferences};return e.shortcutsSettings=JSON.stringify(e.shortcutsSettings),eagle.storage.sync.set(e)}#updateShortcut(){var e=eagle.env.os.isMac?"macOS":"Windows";this.keybindings={...this.shortcutsSettings[e]}}async#broadcastUpdateSettings(){eagle.runtime.broadcast("preference-changed",{senderID:this.#id,dirty:{shortcut:this.#dirty.shortcut,locale:this.#dirty.locale}}),this.#dirty.shortcut=!1,this.#dirty.locale=!1}isURLBlackList(e){var r=new URL(e).hostname;return!!this.domainBlackList.includes(r)||!!this.urlBlackList.includes(e)}}eagle.preference=new Preference;