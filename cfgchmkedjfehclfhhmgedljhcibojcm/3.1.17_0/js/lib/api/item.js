class Item{async addFile(a){a.title&&(a.title=eagle.utils.clearWeirdCharactersAndAvoidLongFileName(a.title)),a.tags&&(a.tags=a.tags.map(e=>e.trim()).filter(e=>e));const o={method:"POST","Content-Type":"application/x-www-form-urlencoded",body:{version:eagle.extension.manifest.version,...a,type:"image"}};if(a.folderID&&a.folderIDs)throw new Error("The folderID and folderIDs should not exist at the same time");if(!eagle.preference.downloadViaBrowser||!a.src.startsWith("http"))return eagle.fetch("http://localhost:41593",o);eagle.downloader.download({url:a.src,type:a.elementType,thumbnailURL:a.thumbnailURL,onStarted:()=>{eagle.downloader.renderProgress()},onProgress:e=>{eagle.downloader.renderProgress()},onComplete:async e=>{var t={name:a.title,website:a.url,annotation:a.annotation,notification:!0};a.tags&&(t.tags=a.tags),a.star&&(t.star=a.star),a.folderID&&(t.folderID=a.folderID),a.folderIDs&&(t.folderIDs=a.folderIDs),a.modificationTime&&(t.modificationTime=a.modificationTime),e.base64.includes("image")||e.base64.includes("video")?(t.url=e.base64,await eagle.fetch("http://localhost:41595/api/item/addFromURL",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t),redirect:"follow"})):await eagle.fetch("http://localhost:41593",o),eagle.downloader.renderProgress()},onError:async e=>{await eagle.fetch("http://localhost:41593",o),eagle.downloader.renderProgress()}})}async addBatchSaveFile(a){a.title&&(a.title=eagle.utils.clearWeirdCharactersAndAvoidLongFileName(a.title)),a.tags&&(a.tags=a.tags.map(e=>e.trim()).filter(e=>e));const o={method:"POST","Content-Type":"application/x-www-form-urlencoded",body:{version:eagle.extension.manifest.version,...a,type:"image"}};if(eagle.env.isAppSupportDownloadViaBrowser||!a.folderID&&a.folderIDs&&a.folderIDs.length&&(a.folderID=a.folderIDs[0],a.folderId=a.folderIDs[0]),eagle.preference.downloadViaBrowser&&a.src.startsWith("http"))eagle.downloader.download({url:a.src,type:a.elementType,thumbnailURL:a.thumbnailURL,onStarted:()=>{eagle.downloader.renderProgress()},onProgress:e=>{eagle.downloader.renderProgress()},onComplete:async e=>{var t={name:a.title,website:a.url,annotation:a.annotation,notification:!0};a.tags&&(t.tags=a.tags),a.star&&(t.star=a.star),a.folderID&&(t.folderID=a.folderID),a.folderIDs&&(t.folderIDs=a.folderIDs),a.modificationTime&&(t.modificationTime=a.modificationTime),e.base64.includes("image")||e.base64.includes("video")?(t.url=e.base64,await eagle.fetch("http://localhost:41595/api/item/addFromURL",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t),redirect:"follow"})):await eagle.fetch("http://localhost:41593",o),eagle.downloader.renderProgress()},onError:async e=>{await eagle.fetch("http://localhost:41593",o),eagle.downloader.renderProgress()}});else{if(!eagle.env.isAppSupportExtensionCollectWindow)return eagle.fetch("http://localhost:41593",o);var e={name:a.title,website:a.url,annotation:a.annotation,notification:!0,url:a.src};a.tags&&(e.tags=a.tags),a.star&&(e.star=a.star),a.folderID&&(e.folderID=a.folderID,e.folderId=a.folderID),a.folderIDs&&(e.folderIDs=a.folderIDs),a.modificationTime&&(e.modificationTime=a.modificationTime),await eagle.fetch("http://localhost:41595/api/item/addFromURL",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e),redirect:"follow"})}}async addScreenshot({base64:e,indexStr:t=""}){t=eagle.utils.clearWeirdCharactersAndAvoidLongFileName(document.title)+t,t={method:"POST","Content-Type":"application/x-www-form-urlencoded",body:{type:"screen capture",version:eagle.extension.manifest.version,title:t,url:location.href,base64:e}};return eagle.fetch("http://localhost:41593",t)}async addURL(e){var t=eagle.utils.clearWeirdCharactersAndAvoidLongFileName(document.title),t={method:"POST","Content-Type":"application/x-www-form-urlencoded",body:{type:"save-url",version:eagle.extension.manifest.version,title:t,...e}};return e.videoThumb?t.body.base64=await eagle.utils.urlToBase64(e.videoThumb,1e4):(t.body.base64=await eagle.screenCapturer.captureCurrentTab({format:"jpeg",quality:85}),t.body.base64&&(e=(await eagle.utils.resizeBase64ImageToMaxSize(e.src,720))["base64"],t.body.base64=e)),eagle.fetch("http://localhost:41593",t)}async batchSave(e){var t={method:"POST","Content-Type":"application/x-www-form-urlencoded",body:{type:"import-images",version:eagle.extension.manifest.version,url:location.href,images:[]}};return e.forEach(e=>{e.title||(e.title=document.title);var t=eagle.utils.clearWeirdCharactersAndAvoidLongFileName(e.title);e.title=t,e.src&&-1<e.src.indexOf(" ")&&(e.src=e.src.trim().split(" ")[0])}),t.body.title=eagle.utils.clearWeirdCharactersAndAvoidLongFileName(document.title),t.body.images=JSON.stringify(e),eagle.logger.info(`[background] batch save[${location.href}] count[${e.length}]`),eagle.fetch("http://localhost:41593",t)}}eagle.item=new Item;