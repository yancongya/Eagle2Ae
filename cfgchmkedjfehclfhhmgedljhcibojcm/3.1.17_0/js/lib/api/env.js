class Environment{os;browser;canvas;appInfo;constructor(){this.os=this.#getOS(),this.browser=this.#getBrowser(),this.canvas=this.#getCanvas()}get browserTheme(){return this.#getBrowserTheme()}get isChrome(){return"chrome"===this.browser.name||"chromium"===this.browser.name||"edge"===this.browser.name}get isSafari(){return"safari"===this.browser.name}get isAppSupportURLEnlarger(){return null!=this.appInfo&&null!=this.appInfo.buildVersion&&!!(20230901<=this.appInfo.buildVersion&&this.appInfo.isVersion4)}get isAppSupportExtensionCollectWindow(){return null!=this.appInfo&&null!=this.appInfo.buildVersion&&!!(20240222<=this.appInfo.buildVersion&&this.appInfo.isVersion4)}get isAppSupportDownloadViaBrowser(){return null!=this.appInfo&&null!=this.appInfo.buildVersion&&!!(20241106<=this.appInfo.buildVersion&&this.appInfo.isVersion4)}shouldShowNewCollectWindow(e=null){var r=this.isAppSupportExtensionCollectWindow,o=eagle.preference.usingCollect;return null===e||""===e?r&&o:"choose"===e&&r}#getOS(){var e=navigator.userAgent,r=-1!==e.indexOf("Win"),e=-1!==e.indexOf("Mac");return{name:r?"Windows":e?"macOS":"unknown",isWindows:r,isMac:e}}#getBrowser(){var e=navigator.userAgent;let r="",o="";return o=/Chrome/.test(e)&&!/Edg/.test(e)?(r="chrome",e.match(/Chrome\/(\d+)\./)?.[1]||"N/A"):/Firefox/.test(e)?(r="firefox",e.match(/Firefox\/(\d+)\./)?.[1]||"N/A"):/Safari/.test(e)&&!/Chrome/.test(e)?(r="safari",e.match(/Version\/(\d+)\./)?.[1]||"N/A"):/Edg/.test(e)?(r="edge",e.match(/Edg\/(\d+)\./)?.[1]||"N/A"):/Chromium/.test(e)?(r="chromium",e.match(/Chromium\/(\d+)\./)?.[1]||"N/A"):(r="unknown","N/A"),{name:r=r.toLowerCase(),version:isNaN(parseInt(o))?o:parseInt(o),isFirefox:()=>"firefox"===r,isChrome:()=>"chrome"===r,isSafari:()=>"safari"===r}}#getCanvas(){let e,r;switch(this.browser.name){case"chrome":case"chromium":case"edge":r=(e=this.browser.version<=76?32750:65500,268435456);break;case"firefox":e=32750,r=117418896;break;case"safari":r=15<=this.browser.version?(e=2e4,67174416):(e=16384,268435456);break;default:e=32750,r=268435456}return{maxSide:e,maxArea:r}}#getBrowserTheme(){if(!this.isBackground()||this.isPopup()||this.isCollectWindow()||this.isBatchSaverWindow())return window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light";throw new Error("Cannot access window.matchMedia in background service worker")}async isReady(){return new Promise(o=>{(async()=>{var e,r;return eagle.runtime.isAvailable?await this.isEagleOpen()?(e=eagle.env.browser.isFirefox(),r=eagle.preference.agreePrivacyPolicy||!1,e&&!r?(eagle.dialog.showPrivacyPolicyDialog(),o(!1)):o(!0)):(eagle.dialog.showEagleNotOpenedDialog(),o(!1)):(eagle.dialog.showRuntimeUpdatedDialog(),o(!1))})()})}async isEagleOpen(){var e=await Promise.all([this.#fetchNewAPI(),this.#fetchOldAPI()]);return this.appInfo=e[0]||e[1],!!this.appInfo}async#fetchNewAPI(){try{let e=await eagle.fetch("http://localhost:41595",{timeout:500});var r;if((e=e.json?e.json():e).data&&e.data.version&&e.data.buildVersion&&e.data.platform&&e.data.preferences)return(r=e.data).buildVersion=parseInt(r.buildVersion),r.isVersion4=!0,r}catch(e){eagle.logger.error("isEagleOpen error",e)}return!1}async#fetchOldAPI(){try{let e=await eagle.fetch("http://localhost:41593",{timeout:500});if(e=e.json?e.json():e)return{showCollectModal:e.showCollectModal}}catch(e){eagle.logger.error("isEagleOpen error",e)}return!1}async isDOMReady(){return new Promise((r,e)=>{$(document).ready(()=>{if(-1<location.hostname.indexOf(".pinterest.")){const e=setInterval(()=>{$("[data-reactcontainer]").length&&(clearInterval(e),r())},100)}else r()})})}isBackground(){var e,r,o;return"undefined"!=typeof browser&&void 0!==browser.runtime?(e=browser&&browser.runtime&&browser.runtime.getBackgroundPage&&browser.runtime.getBackgroundPage()===window,"function"==typeof browser?.runtime?.getBackgroundPage||e):(e="function"==typeof chrome?.runtime?.getBackgroundPage,r=void 0!==chrome.tabs,o=chrome&&chrome.extension&&chrome.extension.getBackgroundPage&&chrome.extension.getBackgroundPage()===window,e||r||o)}isPopup(){var e=location.href.includes("popup.html");return this.isBackground()&&e}isCollectWindow(){var e=location.href.includes("collect-window");return this.isBackground()&&e}isBatchSaverWindow(){var e=location.href.includes("batch-saver-window");return this.isBackground()&&e}}eagle.env=new Environment;