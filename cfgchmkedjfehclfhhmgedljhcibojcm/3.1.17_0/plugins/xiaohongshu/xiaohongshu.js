class PinterestPlugin extends SitePlugin{disableBatchSaver=!0;inject(){setInterval(()=>{this.makeVideoElementCollectable()},500)}onContextMen;makeVideoElementCollectable(){document.querySelectorAll("video:not([eagle-collectable])").forEach((e,t)=>{e.setAttribute("eagle-collectable","true")}),document.querySelectorAll("section.note-item:has(.play-icon) img:not([eagle-collectable][eagle-type])").forEach((e,t)=>{e.setAttribute("eagle-collectable","true"),e.setAttribute("eagle-type","video")})}getMeta(e){var t,r={},a=e.closest("section");return a?(t=a.querySelector("a.title"),a=a.querySelector("a.author"),t&&a?r.title=t.textContent.trim()+" - "+a.textContent.trim():t?r.title=t.textContent.trim():a&&(r.title=a.textContent.trim())):(t=e.closest("div#noteContainer.note-container"))&&(a=t.querySelector("div.title"),e=t.querySelector("div.desc"),t=t.querySelector("a.name"),a&&t?r.title=a.textContent.trim()+" - "+t.textContent.trim():e&&t?r.title=e.textContent.trim()+" - "+t.textContent.trim():t&&(r.title=t.textContent.trim())),r}cutString(e,t,r,a=0,l=!1){a=e.indexOf(t,a);if(-1===a)return"";a+=t.length;let n=e.indexOf(r,a);if(-1===n){if(!l)return"";n=e.length}return e.substr(a,n-a)}extractPageId(e){e=e.match(/\/([a-z0-9]{24})\?/);return e?e[1]:null}isH265Support(){try{var e=document.createElement("video"),t="probably"===e.canPlayType('video/mp4; codecs="avc1.42E01E"')&&"probably"===e.canPlayType('video/mp4; codecs="hev1.1.6.L93.B0"');return e.remove(),t}catch(e){return!1}}async getMetaAsync(a){try{let e=window.location.href;var l=a.closest("a");if(!l?.querySelector("span.play-icon")&&"VIDEO"!==a.tagName)return{};l&&(l.href.includes("/user/profile/")&&(e=l.href),l.href.includes("/explore/")&&(e=l.href),l.href.includes("/search_result/"))&&(e=l.href);var n=this.extractPageId(e);let t="";let r=0;for(a.classList.add("eagle-breathing");r<10;){var i=await(await fetch(e)).text();if(""!==(t=this.cutString(i,'"noteDetailMap":',',"serverRequestInfo":')))break;await new Promise(e=>setTimeout(e,300)),r++}if(a.classList.remove("eagle-breathing"),""===t)throw new Error("retry failed");var o,c=JSON.parse(t)[n];return c?.note?.video?.media?.stream?(o=c.note.video.media.stream,this.isH265Support()&&0<o.h265.length?{src:o.h265[0].masterUrl}:{src:o.h264[0].masterUrl}):{}}catch(e){return{}}finally{a.classList.remove("eagle-breathing")}}}(()=>{var e=new PinterestPlugin;eagle.plugin.register("www.xiaohongshu.com/(.*)",e),e.inject()})();