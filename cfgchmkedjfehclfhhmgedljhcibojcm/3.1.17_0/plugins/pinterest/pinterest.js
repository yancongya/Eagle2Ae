class PinterestPlugin extends SitePlugin{disableBatchSaver=!0;inject(){let t=null;const r=()=>{location.href.includes("pinterest.")&&document.querySelectorAll(['div[data-test-id="pinrep-video"] video:not([eagle-src]):not([eagle-src-loading]):not([eagle-collectable])','div[data-test-id="story-pin-closeup-page"] video:not([eagle-src]):not([eagle-src-loading]):not([eagle-collectable])','div[data-test-id="visual-content-container"] video:not([eagle-src]):not([eagle-src-loading]):not([eagle-collectable])','div[data-test-id="closeup-body-landscape"] video:not([eagle-src]):not([eagle-src-loading]):not([eagle-collectable])'].join(",")).forEach((e,t)=>{e.setAttribute("eagle-collectable","true")})};{let e=!1;setInterval(()=>{location.href==t&&e||(t=location.href,(r=>{let e=document.querySelector('div[role="main"]')||document.querySelector(`div.appContent`);if(null==e)return!1;{let t=new MutationObserver(e=>{r();t.disconnect()});t.observe(e,{childList:true,subtree:true});return true}})(()=>{r()})&&(e=!0))},500)}setInterval(()=>{0!=document.querySelectorAll("video:not([eagle-src]):not([eagle-src-loading])").length&&r()},250)}getMeta(e){var t={src:e.hasAttribute("src")&&e.getAttribute("src")||""};if(null==location.href.match("https://(.*).pinterest.(.*)")||""==t.src)return{};let r=$("[data-grid-item]").has(e);var a=r.find('[data-test-id="pinrep-footer"] a').toArray().map(e=>{var t=e.innerText;return/^\/\w+\/$/.test(e.getAttribute("href"))?"@"+t:t}).join(" ").trim();a&&(t.customTitle=a),!t.customTitle&&(r=$(e).parents('[data-test-id="closeup-lego-container"]'),a=$(r).find('[data-test-id="closeup-title"]')[0]?.innerText)&&(t.customTitle=a),t.customTitle||(t.customTitle=document.title);let i;return"IMG"==e.nodeName?i=e.getAttribute("src").split("/")[7]:"VIDEO"==e.nodeName&&(i=e.getAttribute("poster").split("/")[7]),t}async getMetaAsync(o){return new Promise(async t=>{if("VIDEO"!==o.tagName)return t({});var e=async e=>{try{var t=window.location.hostname,r=await(await fetch(`https://${t}/resource/PinResource/get/?source_url=%2Fpin%2F${e}%2F&data=%7B%22options%22%3A%7B%22isPrefetch%22%3Afalse%2C%22id%22%3A%22${e}%22%2C%22field_set_key%22%3A%22auth_web_main_pin%22%2C%22is_landing_page%22%3Afalse%2C%22allowStale%22%3Afalse%2C%22no_fetch_context_on_resource%22%3Afalse%7D%2C%22context%22%3A%7B%7D%7D`,{headers:{"x-pinterest-pws-handler":"www/pin/[id].js"}})).json(),a=r.resource_response?.data?.videos?.video_list?.V_720P?.url;if(a)return a;var i=r.resource_response?.data?.story_pin_data?.pages?.[0]?.blocks?.[0]?.video?.video_list?.V_HLSV3_MOBILE?.url;if(!i)return!1;try{var l=i.replace("iht/hls","iht/expMp4").replace(".m3u8","_720w.mp4");if((await fetch(l,{method:"HEAD"})).ok)return l;var s=i.replace("hls","720p").replace("m3u8","mp4");if((await fetch(s,{method:"HEAD"})).ok)return s;if(i.includes("iht/hls")){let e=i.replace("iht/hls","iht/expMp4");return e=e.replace(".m3u8","_720w.mp4")}}catch(e){}return i.replace("hls","720p").replace("m3u8","mp4")}catch(e){return!1}},r=e=>e.split("/")[4],a=e=>{return e.closest("a").href.split("/")[4]};try{var i=o.closest('a[href^="/pin/"]')||o.closest("[data-test-pin-id]");if(i)return t({src:await e(a(o))});if(!i)return t({src:await e(r(window.location.href))})}catch(e){}try{var l=o.closest('[data-test-id="closeup-video-with-visibility"]'),s=o.closest('[data-test-id="story-pin-closeup-page"]'),n=o.closest('div[data-test-id="closeup-visual-container"]').querySelector('div[data-test-id="story-pin-closeup-pause-play-overlay"]');return t(l||s||n?{src:await e(r(window.location.href))}:{src:await e(a(o))})}catch(e){return t({})}})}}(()=>{var e=new PinterestPlugin;eagle.plugin.register("(.*).pinterest.(.*)",e),e.inject()})();