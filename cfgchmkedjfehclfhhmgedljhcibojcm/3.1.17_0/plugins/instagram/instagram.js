class InstagramPlugin extends SitePlugin{disableBatchSaver=!0;inject(){let l=null,t=0;function n(){location.href.startsWith("https://www.instagram.com")&&document.querySelectorAll(["li video:not([eagle-src]):not([eagle-src-loading]):not([eagle-collectable])","video:not([eagle-src]):not([eagle-src-loading]):not([eagle-collectable])"].join(",")).forEach((e,t)=>{e.setAttribute("eagle-collectable","true")})}window.addEventListener("load",()=>{n()}),setInterval(()=>{if(location.href!=l)if((l=location.href).includes("/p/")||l.includes("/reel/")){var r=()=>{n()};var e=document.querySelector('div[role="dialog"]'),t=document.querySelector('body div[id^="mount"]');document.querySelector("video");let l;if(null!=e){let t=new MutationObserver(function(e){(l=document.querySelector("video"))&&(r(),t.disconnect())});t.observe(e,{childList:!0,subtree:!0})}else if(null!=t){let n=new MutationObserver(function(e){for(var t=0;t<e.length;t++){var l=e[t];if("attributes"==l.type&&"VIDEO"===l.target.tagName)return r(),void n.disconnect()}});n.observe(t,{childList:!0,subtree:!0,attributes:!0})}}else n()},500);{let e=null;window.addEventListener("scroll",()=>{clearTimeout(e),e=setTimeout(()=>{window.document.body.scrollHeight!=t&&(t=window.document.body.scrollHeight,n())},300)})}n()}getMeta(e){var t,l,n,r;return location.href.includes("instagram.com")?(t={},r=e.closest('a[href^="/p/"]'),l=e.closest("article"),r?(r=r.href,t.link=r,0<(r=document.querySelectorAll("header h2")).length&&(r=r[0].textContent,t.title="@"+r,e.alt)&&(t.title+=" "+e.alt)):l&&(l=(r=l.querySelectorAll("a"))[0],n=r[r.length-1],1<r.length)&&(r=l.getAttribute("href").replaceAll("/",""),t.title="@"+r,t.link=n.href,e.alt)&&(t.title+=" "+e.alt),t):{}}async getMetaAsync(e){if("VIDEO"===e.tagName){const u="article",d='section main[role="main"]';if(e.closest(u)||e.closest(d)){var t=await async function(l){function c(e,t,l=void 0){try{for(var n=t.split("."),r=e,i=0;i<n.length;i++){var o=n[i];if(void 0===r[o])return l;r=r[o]}return r}catch(e){return l}}function s(e){e.setAttribute("eagle-src-loading","true")}function n(e){return e.match(/\/p\/(.+?)\//)?.[0]}function r(i,o,a=null){return new Promise((n,r)=>{var e=o.nextElementSibling;let t=null;var l='div:not([class]) div[role="presentation"]';null==a?(o.closest(u)&&(t=o.closest(u).querySelector(l)),null==o.closest(u)&&o.closest(d)&&(t=o.closest(d).querySelector(l))):t=o.closest("ul").querySelectorAll(l)[a],null==t&&(t=o),s(o),null!=e&&s(e),null!=t&&(s(t),l=document.body.innerHTML.match(/"appId":"(\d+)"/)[1],e=function(e){var t;let l=BigInt(0);for(var n=0;n<e.length;n++)t=e[n],l=BigInt(l*BigInt(64))+BigInt("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".indexOf(t));return l}(i.match(/\/p\/(\S+)\//)[1]).toString(),fetch(`https://i.instagram.com/api/v1/media/${e}/info/`,{credentials:"include",headers:{"x-ig-app-id":l}}).then(e=>e.json()).then(e=>{let t=c(e,"items.0.video_versions.0.url",null);var l;return t||(l=new URLSearchParams(location.search).get("img_index")||1)&&(l=parseInt(l)-1,t=c(e,`items.0.carousel_media.${l}.video_versions.0.url`,null)),t?n(t):r("No video url")}))})}var i;if(location.href.startsWith("https://www.instagram.com")&&e&&!(-1<l.currentSrc.indexOf(".mp4"))){let e=null,t=null;return null!=l.closest(u)&&(t=l.closest("article")),null==l.closest(u)&&null!=l.closest(d)&&(t=l.closest(d)),(e=t&&(i=t.querySelector('div a[href^="/p/"]:not([href$="liked_by/"])'))?i.getAttribute("href"):e)&&e.match(/\/p\/(.+?)\//)?r(n(e),l):null!=n(location.href)?r(n(location.href),l):void 0}}(e);if(t)return{src:t}}}}}(()=>{var e=new InstagramPlugin;eagle.plugin.register("(.*).instagram.com",e),e.inject()})();