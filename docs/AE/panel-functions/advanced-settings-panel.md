# “高级设置”面板功能说明

## 1. 功能与架构

“高级设置”面板是 Eagle2Ae 插件所有可配置项的集中管理中心。与主面板的“快速设置”不同，这里提供了对插件行为更细致、更全面的控制。

此面板在架构上并非一个独立的类，其实现逻辑遵循以下模式：

- **UI结构**: 设置面板的完整DOM结构预先定义在 `index.html` 文件中的一个大型容器 `<div class="settings-panel">` 内，默认状态为隐藏。
- **逻辑驱动**: 面板的所有交互逻辑都集中在 `main.js` 的 `setupSettingsPanel()` 方法中。该方法在插件初始化时执行，为面板内的每一个UI控件（输入框、单选框、复选框等）绑定独立的事件监听器。
- **激活方式**: 当用户点击主界面右上角的“设置”图标 (⚙️) 时，会触发 `showSettingsPanel()` 函数，此函数仅负责将 `.settings-panel` 容器的 `display` 样式设置为 `flex`，使其可见。

## 2. 核心机制：即时保存

“高级设置”面板的一个核心设计理念是 **即时保存 (Live Save)**。

- **无“保存”按钮**: 面板上不存在“保存”或“应用”按钮。
- **自动持久化**: 用户的**任何修改都会立即触发对应控件的 `change` 事件**，该事件会调用 `settingsManager.set(...)` 方法，将新的设置值实时、自动地写入浏览器的 `localStorage` 中。
- **即时生效**: 所有设置都是即时生效的，关闭面板后，插件将按照最新的设置运行。

## 3. 设置项分区详解

面板内的设置项按功能分为多个区域：

### 3.1 导入设置 (Import Settings)

此区域控制文件从Eagle导入到AE时的核心行为。

- **导入模式 (Import Mode)**: 与主面板的快速设置联动，决定文件的存放位置（直接链接、项目旁复制、自定义文件夹）。选择后两者会触发对应的小窗进行额外配置。
- **导入行为 (Import Behavior)**: 与主面板的快速设置联动，决定文件导入后在时间轴上的行为（不导入合成、在当前时间点添加、在时间轴起点添加）。

### 3.2 序列帧设置 (Sequence Settings)

此区域专门处理图像序列的导入逻辑。

- **自动检测序列帧**: 控制是否在拖拽文件夹时自动识别图像序列。
- **最小文件数**: 定义了识别一个序列所需的最少连续文件数量。
- **默认帧率**: 为导入的图像序列指定的默认帧率。

### 3.3 导出设置 (Export Settings)

此区域控制从AE导出图层时的行为（例如使用“导出图层”或“导出到Eagle”按钮时）。

- **默认导出路径**: 为“导出图层”功能指定一个默认的文件保存位置。
- **导出格式**: 目前默认为PNG，未来可能扩展。
- **文件名模板**: 定义导出文件的命名规则。

### 3.4 通信设置 (Communication Settings)

- **通讯端口号**: 设置与Eagle插件通信的端口号。修改此项需要重启AE插件和Eagle插件才能生效。

### 3.5 其他设置 (Miscellaneous)

- **音效开关**: 控制插件在执行关键操作（如连接成功、导入成功/失败）时是否播放提示音。

## 4. 数据流

设置面板的数据流清晰、直接：

1.  **加载 (Load)**: 当 `showSettingsPanel()` 被调用时，会首先执行 `syncQuickToAdvanced()`，将主面板的快速设置同步到高级面板。接着，面板内的各个UI控件会从 `settingsManager` 中读取当前的设置值并填充自身（例如，选中对应的单选框）。
2.  **保存 (Save)**: 当用户修改任何一个UI控件（如点击一个复选框）时，该控件的 `change` 事件被触发，其事件回调函数会立即调用 `settingsManager.set('settingName', newValue)`，将新值写入 `localStorage`。
3.  **同步 (Sync)**: 同时，事件回调函数还会调用 `syncAdvancedToQuick()`，确保主面板的快速设置UI也同步更新，保持两边数据的一致性。

---

**相关文档**:
- [UI组件说明](../api/ui-components.md)
- [导入设置指南](./import-settings-guide.md)
- [导出路径设置](./export-path-settings.md)
