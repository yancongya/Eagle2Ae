# Eagle2Ae 后台服务插件 - UI窗口更新

## 更新说明

根据Eagle官方文档，后台服务插件（`serviceMode: true`）也可以拥有管理窗口。本次更新为Eagle2Ae插件添加了可视化管理界面，同时保持原有的后台服务功能。

## 主要修改

### 1. manifest.json 配置更新
- 保持 `"serviceMode": true`（后台服务模式）
- 将 `url` 从 `service.html` 改为 `index.html`
- 设置窗口可见：`"visible": true`, `"show": true`
- 设置合适的窗口大小：800x600
- 允许窗口调整大小和最小化/最大化

### 2. index.html 界面完善
- 添加了完整的管理界面
- 服务状态监控区域
- 当前选中文件显示
- 手动导出按钮
- 设置面板
- 操作日志显示
- 实时UI更新功能

### 3. plugin.js 逻辑调整
- 添加UI模式检测（通过检查DOM中的#message元素）
- 在UI模式下保持窗口可见
- 在纯服务模式下仍然隐藏窗口
- 添加设置更新功能
- 添加UI状态更新接口

## 功能特性

### 后台服务功能（保持不变）
- ✅ Eagle启动时自动启动
- ✅ 监控文件选择操作
- ✅ 自动导出到After Effects
- ✅ HTTP服务器通信
- ✅ 动态端口分配

### 新增管理窗口功能
- ✅ 实时服务状态显示
- ✅ 当前选中文件预览
- ✅ 手动导出操作
- ✅ 设置配置面板
- ✅ 操作日志记录
- ✅ 运行时间统计

## 使用方式

### 后台服务模式
插件会在Eagle启动时自动启动后台服务，无需用户干预。当用户在Eagle中选择文件并点击插件时，会自动导出到After Effects。

### 管理窗口模式
用户可以通过插件菜单打开管理窗口，查看：
- 服务运行状态
- HTTP服务器状态
- After Effects连接状态
- 当前选中的文件列表
- 操作日志

### 设置配置
通过管理窗口的"设置"按钮可以配置：
- After Effects项目路径
- 导出文件夹名称
- 自动导入选项
- 通知显示选项
- HTTP服务器端口

## 技术实现

### 模式检测
```javascript
// 通过检查DOM环境判断是否为UI模式
if (typeof document !== 'undefined' && document.querySelector('#message')) {
    this.uiMode = true;
    this.log('检测到UI环境，启用窗口模式');
} else {
    this.log('纯服务模式，无UI界面');
}
```

### 窗口控制
- UI模式：保持窗口可见，允许用户交互
- 服务模式：强制隐藏窗口，纯后台运行

### 状态同步
- UI界面每秒更新一次状态
- 实时显示选中文件列表
- 日志信息同步显示

## 兼容性

- ✅ 保持原有后台服务功能完全不变
- ✅ 向后兼容现有配置
- ✅ 支持纯服务模式和UI模式切换
- ✅ 不影响After Effects通信协议

## 测试

可以使用 `test-ui.html` 文件测试UI功能是否正常工作。

## 注意事项

1. 关闭管理窗口不会停止后台服务
2. 后台服务会持续运行直到Eagle关闭
3. 设置更改会立即生效
4. 日志最多保留50条记录
