# UI 组件分析

KBar 的前端界面 (`toolbar.html` 和 `config.html`) 是基于 **React** 框架动态构建的。这意味着 UI 由一系列可复用的 React 组件组成，这些组件管理自身的状态并通过 props 传递数据和回调。

## 核心 UI 框架

*   **React**: 用于构建声明式用户界面。
*   **ReactDOM**: 将 React 组件渲染到 DOM 中。
*   **JSS (JavaScript Style Sheets)**: 从代码中推断，可能用于管理组件的样式，允许在 JavaScript 中定义 CSS。

## 工具栏 (`toolbar.html`) 组件结构 (推测)

`toolbar.js` 负责渲染工具栏界面。其核心UI组件结构可能如下：

### 1. `App` 组件 (根组件)
*   **描述**: 整个工具栏的根 React 组件，负责初始化、加载全局设置、管理工具栏的整体状态和布局。
*   **功能**:
    *   从 `KBarService` 获取并加载工具栏配置。
    *   渲染 `ToolbarContainer`。
    *   处理全局事件（如设置更新）。

### 2. `ToolbarContainer` 组件
*   **描述**: 负责工具栏的布局和按钮的渲染。
*   **功能**:
    *   根据配置决定工具栏是水平还是垂直布局。
    *   遍历按钮配置数据，渲染一系列 `Button` 和 `Separator` 组件。
    *   处理按钮的拖拽排序逻辑。

### 3. `Button` 组件
*   **描述**: 单个按钮的 React 组件。
*   **功能**:
    *   显示按钮的标签、图标。
    *   处理点击事件，调用 `KBarService` 或 `evalScript` 执行相应动作。
    *   处理右键菜单（上下文菜单）。
    *   显示工具提示。

### 4. `Separator` 组件
*   **描述**: 视觉分隔符组件。
*   **功能**: 仅渲染一个视觉分隔线，没有交互逻辑。

### 5. `SettingsCog` 组件 (设置按钮)
*   **描述**: 一个特殊的按钮组件，通常显示为齿轮图标。
*   **功能**: 点击后触发打开配置面板 (`config.html`) 的操作。

## 配置面板 (`config.html`) 组件结构 (推测)

`config.js` 负责渲染配置面板界面。其组件结构可能更为复杂，用于管理和编辑工具栏的详细设置。

### 1. `ConfigApp` 组件 (根组件)
*   **描述**: 配置面板的根 React 组件，负责加载和保存所有 KBar 设置。
*   **功能**:
    *   从 `KBarService` 加载所有工具栏的配置。
    *   管理配置面板的全局状态。
    *   渲染 `ToolbarSelector`、`ButtonList` 和 `ButtonEditor` 等组件。
    *   处理设置的保存操作，调用 `KBarService.setUserConfigAsync()`。

### 2. `ToolbarSelector` 组件
*   **描述**: 允许用户选择要编辑的特定工具栏（KBar 1-4）。
*   **功能**:
    *   显示当前可用的工具栏列表。
    *   处理工具栏切换事件，更新配置面板显示。

### 3. `ButtonList` 组件
*   **描述**: 显示当前选中工具栏的所有按钮和分隔符的列表。
*   **功能**:
    *   支持按钮的拖拽排序。
    *   处理按钮的添加、删除操作。
    *   点击列表项时，将按钮数据传递给 `ButtonEditor` 进行编辑。

### 4. `ButtonEditor` 组件
*   **描述**: 一个复杂的表单组件，用于编辑单个按钮的所有属性。
*   **功能**:
    *   根据按钮类型（脚本、命令等）动态显示不同的输入字段。
    *   **脚本编辑**: 可能集成了一个代码编辑器（如 CodeMirror），用于编写内联 JSX 脚本。
    *   **文件选择**: 提供文件选择器用于指定外部脚本或图标文件。
    *   **命令/效果搜索**: 可能包含搜索功能，帮助用户查找 AE 菜单命令或效果。
    *   输入验证和错误提示。

### 5. `GlobalSettings` 组件
*   **描述**: 用于编辑 KBar 全局设置的组件，例如导入/导出配置、重置设置、主题选择等。
*   **功能**:
    *   提供导入/导出 `.kzip` 文件的 UI。
    *   处理全局设置的保存和加载。