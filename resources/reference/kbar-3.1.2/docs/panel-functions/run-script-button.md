# 面板功能: 运行脚本按钮

“运行脚本”是 KBar 最强大和最常用的功能之一。它允许用户将任何 JSX 脚本绑定到一个按钮上，实现一键执行。

## 功能类型

此功能分为两种按钮类型：

1.  **内联脚本 (Inline Script)**
    *   **用途**: 用于执行简短、一次性的脚本。
    *   **配置**: 用户在 KBar 配置面板的文本编辑器中直接编写 JSX 代码。
    *   **优点**: 快速、方便，无需管理外部文件。
    *   **缺点**: 不利于代码复用和复杂逻辑。

2.  **脚本文件 (Script File)**
    *   **用途**: 用于执行大型、复杂或需要在多个地方复用的脚本。
    *   **配置**: 用户通过文件选择器，将按钮链接到一个本地磁盘上的 `.jsx` 或 `.jsxbin` 文件。
    *   **优点**: 易于维护、可版本控制、可加密（使用 `.jsxbin`）。
    *   **缺点**: 需要管理外部文件依赖。

## 执行流程

1.  用户点击一个“运行脚本”类型的按钮。
2.  `toolbar.js` 捕获点击事件，并识别出按钮的类型和数据。
3.  **对于内联脚本**:
    *   JavaScript 获取存储的脚本字符串。
    *   对字符串进行转义处理。
    *   调用 `CSInterface.evalScript('KBar.runScript("...")')`。
4.  **对于脚本文件**:
    *   JavaScript 获取存储的文件路径。
    *   调用 `CSInterface.evalScript('KBar.runScriptFile("...")')`。
5.  `all.jsxbin` 中对应的函数被执行，它会在 After Effects 的宿主环境中运行该脚本或文件。
6.  脚本的返回值（如果有）或错误信息被传回给 `toolbar.js` 的回调函数，并可能在控制台中打印出来。

## 最佳实践

*   对于超过 5-10 行的脚本，建议使用“脚本文件”类型，以便于编辑和管理。
*   在编写内联脚本时，注意脚本必须是单行的，或者在 `evalScript` 调用前被正确地处理为单行字符串。
*   利用 `alert()` 或 `JSON.stringify()` 在脚本中进行调试，其结果会返回到浏览器的 `console` 中。
