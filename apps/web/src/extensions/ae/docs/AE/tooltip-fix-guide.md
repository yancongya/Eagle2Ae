# CEP环境下JSX弹窗悬浮提示修复指南

## 问题描述

在Eagle2Ae项目中，Web环境的模拟数据面板悬浮提示功能正常工作，但CEP环境下的JSX面板缺少悬浮提示功能。用户无法通过悬浮获取图层的详细信息，如原始路径、文件大小等。

## 修复方案

### 1. 技术实现

#### 1.1 使用ExtendScript原生helpTip属性
```javascript
// 为每个图层元素设置helpTip
element.helpTip = tooltipText;
```

#### 1.2 添加点击事件显示详细信息
```javascript
// 点击图层项显示详细信息对话框
element.onClick = function() {
    showLayerDetailDialog(layer, canExport);
};
```

#### 1.3 生成丰富的悬浮提示内容
- 图层分类信息（素材/设计文件）
- 导出状态（可导出/不可导出及原因）
- 文件路径信息
- 文件大小和修改时间
- 特殊图层的额外信息（如文本内容）

### 2. 修复内容

#### 2.1 修改的文件
- `jsx/dialog-summary.jsx` - 主要修复文件
- `jsx/test-tooltip.jsx` - 测试脚本（新增）
- `jsx/test-tooltip.jsx` - 测试脚本（新增）

#### 2.2 新增功能

**悬浮提示功能**：
- 使用ExtendScript原生的`helpTip`属性
- 鼠标悬浮在图层项上显示详细信息
- 包含路径、大小、修改时间等信息

**点击详情功能**：
- 点击图层项弹出详细信息对话框
- 显示完整的图层信息
- 作为悬浮提示的补充

**智能内容生成**：
- 根据图层类型生成不同的提示内容
- 素材文件显示原始路径和文件信息
- 设计文件标注"可导出"状态
- 文本图层显示部分文本内容

### 3. 使用方法

#### 3.1 正常使用
1. 在CEP环境下打开图层检测弹窗
2. 将鼠标悬浮在图层列表项上
3. 查看显示的悬浮提示信息
4. 点击图层项查看详细信息对话框
#### 3.2 测试验证
运行测试脚本验证功能：
```javascript
// 在ExtendScript Toolkit或AE脚本面板中运行
#include "jsx/test-tooltip.jsx"
```
运行测试脚本验证功能：
```javascript
// 在ExtendScript Toolkit或AE脚本面板中运行
#include "jsx/test-tooltip.jsx"
```

### 4. 悬浮提示内容示例

#### 4.1 素材文件
```
图片 - 不可导出
原因: 素材文件不可导出
路径: C:\Users\Test\image.jpg
大小: 1.95 MB
修改时间: 2024/1/15 14:30:25
```

#### 4.2 设计文件
```
设计文件 - 可导出
路径: C:\Users\Test\design.psd
大小: 4.88 MB
修改时间: 2024/1/15 15:20:10
```

#### 4.3 文本图层
```
文本 - 可导出
文本内容: 这是一个测试文本图层的内容...
```

### 5. 技术细节

#### 5.1 ExtendScript限制
- ExtendScript环境下无法使用HTML的title属性
- 鼠标事件支持有限，onMouseover/onMouseout不稳定
- 需要使用原生的helpTip属性实现悬浮提示

#### 5.2 兼容性处理
- 使用try-catch包装所有悬浮提示相关代码
- 静默处理错误，避免影响主要功能
- 提供降级方案（alert对话框）

#### 5.3 性能优化
- 悬浮提示文本在添加时生成，避免重复计算
- 文件信息获取使用缓存机制
- 错误处理不影响界面响应速度

### 6. 与Web环境的对比

| 功能 | Web环境 | CEP环境（修复前） | CEP环境（修复后） |
|------|---------|------------------|------------------|
| 悬浮提示 | ✅ HTML title | ❌ 无 | ✅ helpTip |
| 详细信息 | ✅ 悬浮显示 | ❌ 无 | ✅ 点击显示 |
| 路径信息 | ✅ 显示 | ❌ 无 | ✅ 显示 |
| 文件信息 | ✅ 显示 | ❌ 无 | ✅ 显示 |
| 交互体验 | 悬浮即显示 | 无交互 | 悬浮+点击 |

### 7. 故障排除

#### 7.1 悬浮提示不显示
- 检查ExtendScript版本是否支持helpTip
- 确认图层数据包含必要的信息
- 查看控制台是否有错误信息

#### 7.2 点击事件无响应
- 确认onClick事件绑定成功
- 检查图层数据是否完整
- 尝试重新打开弹窗

#### 7.3 文件信息显示异常
- 检查文件路径是否存在
- 确认文件访问权限
- 验证文件对象属性

### 8. 后续优化建议

1. **增强悬浮提示样式**：研究ExtendScript是否支持自定义悬浮提示样式
2. **添加键盘快捷键**：为详细信息对话框添加快捷键支持
3. **缓存优化**：对文件信息进行缓存，提高响应速度
4. **国际化支持**：为悬浮提示内容添加多语言支持

---

## 总结

通过使用ExtendScript原生的helpTip属性和点击事件，成功为CEP环境下的JSX弹窗添加了悬浮提示功能。修复后的功能与Web环境保持一致，用户可以方便地查看图层的详细信息，包括原始路径、文件大小、修改时间等。

修复方案考虑了ExtendScript环境的限制，使用了稳定可靠的实现方式，并提供了完善的错误处理和降级方案，确保功