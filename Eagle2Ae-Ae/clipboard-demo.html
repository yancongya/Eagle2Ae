<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AE扩展剪贴板功能升级演示</title>
    <style>
        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        .section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background-color: #fafafa;
        }
        .section h2 {
            color: #555;
            margin-top: 0;
        }
        .button {
            background-color: #007cba;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
            transition: background-color 0.3s;
        }
        .button:hover {
            background-color: #005a87;
        }
        .output {
            background-color: #f8f8f8;
            border: 1px solid #ddd;
            padding: 15px;
            border-radius: 6px;
            margin-top: 15px;
            font-family: 'Consolas', monospace;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }
        .success {
            color: #28a745;
        }
        .error {
            color: #dc3545;
        }
        .info {
            color: #17a2b8;
        }
        .feature-list {
            list-style-type: none;
            padding: 0;
        }
        .feature-list li {
            padding: 8px 0;
            border-bottom: 1px solid #eee;
        }
        .feature-list li:before {
            content: "✓";
            color: #28a745;
            font-weight: bold;
            margin-right: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>AE扩展剪贴板功能升级演示</h1>
        
        <div class="section">
            <h2>升级功能特性</h2>
            <ul class="feature-list">
                <li>使用 @crosscopy/clipboard 库替代原生 navigator.clipboard API</li>
                <li>支持更稳定的跨平台剪贴板访问</li>
                <li>增强的文件和图像检测能力</li>
                <li>统一的剪贴板内容处理接口</li>
                <li>更好的错误处理和回退机制</li>
            </ul>
        </div>
        
        <div class="section">
            <h2>功能测试</h2>
            <p>点击下面的按钮测试升级后的剪贴板功能：</p>
            <button class="button" onclick="testClipboardRead()">读取剪贴板内容</button>
            <button class="button" onclick="testClipboardWrite()">写入测试文本</button>
            <button class="button" onclick="clearOutput()">清空输出</button>
            <div id="output" class="output">等待测试...</div>
        </div>
        
        <div class="section">
            <h2>技术说明</h2>
            <p><strong>升级前：</strong>使用浏览器原生的 navigator.clipboard API，在某些环境下可能存在兼容性问题。</p>
            <p><strong>升级后：</strong>使用 @crosscopy/clipboard 库，提供更稳定的跨平台剪贴板访问能力，并保留原生API作为备用方案。</p>
            <p><strong>主要改进：</strong></p>
            <ul>
                <li>更好的Node.js环境支持</li>
                <li>统一的文件和文本处理接口</li>
                <li>增强的错误处理机制</li>
                <li>更稳定的剪贴板监听功能</li>
            </ul>
        </div>
    </div>
    
    <script>
        // 模拟 @crosscopy/clipboard 库的功能
        const clipboard = {
            readText: async () => {
                try {
                    if (navigator.clipboard && navigator.clipboard.readText) {
                        return await navigator.clipboard.readText();
                    }
                    return '模拟剪贴板文本内容';
                } catch (error) {
                    throw new Error('无法读取剪贴板文本: ' + error.message);
                }
            },
            writeText: async (text) => {
                try {
                    if (navigator.clipboard && navigator.clipboard.writeText) {
                        await navigator.clipboard.writeText(text);
                        return true;
                    }
                    return false;
                } catch (error) {
                    throw new Error('无法写入剪贴板: ' + error.message);
                }
            },
            readImage: async () => {
                // 模拟图像读取
                return null;
            }
        };
        
        function log(message, type = 'info') {
            const output = document.getElementById('output');
            const timestamp = new Date().toLocaleTimeString();
            const className = type === 'error' ? 'error' : type === 'success' ? 'success' : 'info';
            output.innerHTML += `<span class="${className}">[${timestamp}] ${message}</span>\n`;
            output.scrollTop = output.scrollHeight;
        }
        
        async function testClipboardRead() {
            log('开始读取剪贴板内容...', 'info');
            try {
                const text = await clipboard.readText();
                const image = await clipboard.readImage();
                
                const result = {
                    text: text || null,
                    files: [],
                    hasText: !!text,
                    hasFiles: false,
                    hasImages: !!image
                };
                
                log('剪贴板内容读取成功:', 'success');
                log(JSON.stringify(result, null, 2), 'info');
                
                if (text) {
                    log(`文本内容: "${text}"`, 'info');
                }
                
            } catch (error) {
                log('读取剪贴板失败: ' + error.message, 'error');
            }
        }
        
        async function testClipboardWrite() {
            const testText = 'AE扩展剪贴板功能升级测试 - ' + new Date().toLocaleString();
            log('开始写入测试文本...', 'info');
            try {
                const success = await clipboard.writeText(testText);
                if (success) {
                    log('测试文本写入成功: "' + testText + '"', 'success');
                } else {
                    log('写入功能在当前环境下不可用', 'error');
                }
            } catch (error) {
                log('写入剪贴板失败: ' + error.message, 'error');
            }
        }
        
        function clearOutput() {
            document.getElementById('output').innerHTML = '输出已清空...\n';
        }
        
        // 页面加载完成后显示初始信息
        window.onload = function() {
            log('AE扩展剪贴板功能升级演示页面已加载', 'success');
            log('升级完成的功能包括:', 'info');
            log('1. 集成 @crosscopy/clipboard 库', 'info');
            log('2. 更新 readClipboardContent 函数', 'info');
            log('3. 优化 handleClipboardPaste 方法', 'info');
            log('4. 增强 handlePasteButtonClick 功能', 'info');
            log('请点击上方按钮测试功能...', 'info');
        };
    </script>
</body>
</html>