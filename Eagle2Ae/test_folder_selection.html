<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>文件夹选择功能测试</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            font-size: 12px;
            background: #383838;
            color: #e0e0e0;
            padding: 20px;
            line-height: 1.4;
            margin: 0;
        }
        
        .test-container {
            max-width: 800px;
            margin: 0 auto;
        }
        
        .test-section {
            background: #2a2a2a;
            padding: 16px;
            border-radius: 6px;
            margin-bottom: 16px;
            border: 1px solid #555;
        }
        
        .test-section h3 {
            color: #3498db;
            margin: 0 0 12px 0;
            font-size: 14px;
        }
        
        .test-section p {
            margin: 8px 0;
            font-size: 11px;
            color: #bbb;
        }
        
        .test-buttons {
            display: flex;
            gap: 8px;
            margin: 12px 0;
            flex-wrap: wrap;
        }
        
        .test-btn {
            background: #3498db;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 8px 12px;
            font-size: 10px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .test-btn:hover {
            background: #2980b9;
        }
        
        .test-btn.success {
            background: #27ae60;
        }
        
        .test-btn.warning {
            background: #f39c12;
        }
        
        .test-btn.danger {
            background: #e74c3c;
        }
        
        .result-display {
            background: #1e1e1e;
            border: 1px solid #555;
            border-radius: 4px;
            padding: 12px;
            margin: 8px 0;
            font-family: 'Courier New', monospace;
            font-size: 10px;
            white-space: pre-wrap;
            max-height: 200px;
            overflow-y: auto;
        }
        
        .status-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 6px;
        }
        
        .status-indicator.success {
            background: #27ae60;
        }
        
        .status-indicator.error {
            background: #e74c3c;
        }
        
        .status-indicator.info {
            background: #3498db;
        }
        
        iframe {
            width: 100%;
            height: 400px;
            border: 1px solid #555;
            border-radius: 6px;
            background: white;
            margin-top: 12px;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <div class="test-section">
            <h3>文件夹选择功能测试</h3>
            <p>测试AE扩展的文件夹选择和路径保存功能</p>
            
            <div class="test-buttons">
                <button class="test-btn" onclick="testFolderSelection()">测试文件夹选择</button>
                <button class="test-btn success" onclick="testRecentFolders()">测试最近文件夹</button>
                <button class="test-btn warning" onclick="testPathSaving()">测试路径保存</button>
                <button class="test-btn danger" onclick="clearRecentFolders()">清空最近文件夹</button>
            </div>
            
            <div id="test-results" class="result-display">等待测试...</div>
        </div>
        
        <div class="test-section">
            <h3>功能改进说明</h3>
            <p><span class="status-indicator success"></span><strong>文件夹选择对话框：</strong>使用CEP的Folder.selectDialog()替代简单的prompt输入</p>
            <p><span class="status-indicator success"></span><strong>最近使用文件夹：</strong>自动保存和显示最近选择的10个文件夹路径</p>
            <p><span class="status-indicator success"></span><strong>路径验证：</strong>自动验证文件夹路径的有效性</p>
            <p><span class="status-indicator success"></span><strong>实时保存：</strong>路径选择后立即保存到设置中</p>
            <p><span class="status-indicator info"></span><strong>降级处理：</strong>如果CEP对话框失败，自动降级到输入框方式</p>
        </div>
        
        <div class="test-section">
            <h3>AE扩展界面</h3>
            <p>下方是实际的AE扩展界面，可以直接测试文件夹选择功能</p>
            <iframe src="index.html" id="aeExtensionFrame"></iframe>
        </div>
    </div>
    
    <script>
        let testResults = [];
        
        function logTest(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            testResults.push(`[${timestamp}] ${type.toUpperCase()}: ${message}`);
            updateTestDisplay();
        }
        
        function updateTestDisplay() {
            const display = document.getElementById('test-results');
            display.textContent = testResults.join('\n');
            display.scrollTop = display.scrollHeight;
        }
        
        function testFolderSelection() {
            logTest('开始测试文件夹选择功能...', 'info');
            
            const frame = document.getElementById('aeExtensionFrame');
            const frameWindow = frame.contentWindow;
            
            if (frameWindow.aeExtension) {
                // 打开设置面板
                frameWindow.aeExtension.showSettingsPanel();
                
                // 切换到自定义文件夹模式
                const customModeRadio = frameWindow.document.querySelector('input[name="import-mode"][value="custom_folder"]');
                if (customModeRadio) {
                    customModeRadio.checked = true;
                    customModeRadio.dispatchEvent(new Event('change'));
                    logTest('已切换到自定义文件夹模式', 'success');
                } else {
                    logTest('未找到自定义文件夹模式选项', 'error');
                }
                
                logTest('请在AE扩展中点击"浏览..."按钮测试文件夹选择', 'info');
            } else {
                logTest('AE扩展未加载完成，请稍后再试', 'error');
            }
        }
        
        function testRecentFolders() {
            logTest('开始测试最近文件夹功能...', 'info');
            
            const frame = document.getElementById('aeExtensionFrame');
            const frameWindow = frame.contentWindow;
            
            if (frameWindow.aeExtension && frameWindow.aeExtension.settingsManager) {
                const recentFolders = frameWindow.aeExtension.settingsManager.getRecentFolders();
                logTest(`当前最近文件夹数量: ${recentFolders.length}`, 'info');
                
                recentFolders.forEach((folder, index) => {
                    logTest(`${index + 1}. ${folder}`, 'info');
                });
                
                if (recentFolders.length === 0) {
                    logTest('暂无最近使用的文件夹', 'info');
                }
            } else {
                logTest('无法访问设置管理器', 'error');
            }
        }
        
        function testPathSaving() {
            logTest('开始测试路径保存功能...', 'info');
            
            const frame = document.getElementById('aeExtensionFrame');
            const frameWindow = frame.contentWindow;
            
            if (frameWindow.aeExtension && frameWindow.aeExtension.settingsManager) {
                // 添加测试路径
                const testPaths = [
                    'C:\\Users\\Test\\Documents\\AE_Projects',
                    'D:\\Work\\Assets\\Import',
                    'E:\\Media\\Eagle_Export'
                ];
                
                testPaths.forEach(path => {
                    frameWindow.aeExtension.settingsManager.addRecentFolder(path);
                    logTest(`已添加测试路径: ${path}`, 'success');
                });
                
                // 更新下拉列表
                frameWindow.aeExtension.updateRecentFoldersDropdown();
                logTest('已更新最近文件夹下拉列表', 'success');
                
                logTest('请检查AE扩展设置面板中的最近文件夹下拉列表', 'info');
            } else {
                logTest('无法访问设置管理器', 'error');
            }
        }
        
        function clearRecentFolders() {
            logTest('开始清空最近文件夹...', 'info');
            
            const frame = document.getElementById('aeExtensionFrame');
            const frameWindow = frame.contentWindow;
            
            if (frameWindow.aeExtension && frameWindow.aeExtension.settingsManager) {
                // 清空最近文件夹
                frameWindow.aeExtension.settingsManager.recentFolders = [];
                localStorage.removeItem('ae_extension_recent_folders');
                
                // 更新下拉列表
                frameWindow.aeExtension.updateRecentFoldersDropdown();
                
                logTest('已清空最近文件夹列表', 'success');
            } else {
                logTest('无法访问设置管理器', 'error');
            }
        }
        
        // 等待iframe加载完成
        document.getElementById('aeExtensionFrame').onload = function() {
            logTest('AE扩展测试页面加载完成', 'success');
            logTest('可以开始测试文件夹选择功能', 'info');
        };
        
        // 初始化
        logTest('文件夹选择功能测试页面已加载', 'info');
    </script>
</body>
</html>
