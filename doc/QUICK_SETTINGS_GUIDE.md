# Eagle2Ae 快速设置功能使用指南

## 功能概述

Eagle2Ae 扩展插件现已支持双重操作入口和实时设置同步功能，为用户提供更便捷的设置管理体验。

### 主要特性

1. **双重操作入口**
   - **快速设置**：在主操作面板直接访问常用选项
   - **高级设置**：完整的详细配置面板

2. **实时双向同步**
   - 任一面板的设置修改会立即同步到另一面板
   - 使用事件驱动机制确保数据一致性

3. **自动保存**
   - 设置修改后500ms内自动保存
   - 实时保存状态指示
   - 自动持久化到localStorage

## 界面布局

### 主操作面板

```
┌─────────────────────────────┐
│ Eagle2Ae                    │
├─────────────────────────────┤
│ 项目信息                    │
│ • 项目: [项目名称]          │
│ • 合成: [合成名称]          │
│ • 状态: [状态信息]          │
├─────────────────────────────┤
│ 快速设置                    │ ← 新增区域
│ • 导入模式: [下拉选择]      │
│ • 项目文件夹: [条件显示]    │
│ • ☑ 自动添加到当前合成      │
│ • ☑ 保持原始文件名          │
│ • 保存状态: ● 设置已保存    │
├─────────────────────────────┤
│ 操作                        │
│ [测试连接] [断开连接]       │
│ [刷新状态] [高级设置]       │ ← 按钮文本已更新
└─────────────────────────────┘
```

### 快速设置控件说明

1. **导入模式下拉选择器**
   - 直接导入：从Eagle直接导入到AE项目
   - 项目旁复制：复制到AE项目文件旁边后导入
   - 指定文件夹：复制到指定文件夹后导入

2. **条件显示控件**
   - 选择"项目旁复制"时显示项目文件夹选择器
   - 选择"指定文件夹"时显示文件夹路径输入框

3. **核心选项复选框**
   - 自动添加到当前合成：控制是否自动将导入的文件添加到当前合成
   - 保持原始文件名：控制是否保持Eagle中的原始文件名

4. **保存状态指示器**
   - ● 正在保存...（橙色，带脉冲动画）
   - ● 设置已保存（绿色）
   - ● 保存失败（红色）

## 使用方法

### 快速设置操作

1. **修改导入模式**
   ```
   1. 在快速设置区域点击"导入模式"下拉选择器
   2. 选择所需的导入模式
   3. 相关的条件控件会自动显示/隐藏
   4. 设置会在500ms内自动保存
   ```

2. **调整核心选项**
   ```
   1. 点击相应的复选框切换选项状态
   2. 设置立即生效并自动保存
   3. 保存状态指示器会显示保存进度
   ```

### 高级设置操作

1. **打开高级设置面板**
   ```
   1. 点击操作区域的"高级设置"按钮
   2. 面板会覆盖整个界面显示
   3. 所有详细配置选项都在此面板中
   ```

2. **设置同步验证**
   ```
   1. 在快速设置中修改任意选项
   2. 打开高级设置面板
   3. 验证相应选项已同步更新
   4. 反之亦然
   ```

## 技术实现

### 数据绑定机制

- 使用 `SettingsManager` 类的字段级监听器实现双向绑定
- 支持嵌套对象路径（如 `fileManagement.keepOriginalName`）
- 防循环更新机制确保数据一致性

### 自动保存系统

```javascript
// 防抖自动保存（500ms延迟）
triggerAutoSave() {
    if (this.autoSaveTimeout) {
        clearTimeout(this.autoSaveTimeout);
    }
    this.autoSaveTimeout = setTimeout(() => {
        this.performAutoSave();
    }, 500);
}
```

### 事件处理流程

```
用户操作 → 控件事件 → updateField() → 
字段监听器 → UI同步 → 自动保存 → 
状态指示 → Eagle插件同步
```

## 故障排除

### 常见问题

1. **设置不同步**
   - 检查浏览器控制台是否有JavaScript错误
   - 确认 `quickSettingsInitialized` 标志已设置

2. **自动保存失败**
   - 检查localStorage是否可用
   - 查看保存状态指示器的错误提示

3. **界面显示异常**
   - 确认CSS样式文件加载正常
   - 检查HTML结构是否完整

### 调试方法

1. **开启浏览器开发者工具**
   ```
   F12 → Console 标签页
   查看相关错误信息和调试日志
   ```

2. **检查localStorage数据**
   ```
   F12 → Application → Storage → Local Storage
   查看 eagle2ae_importSettings 键值
   ```

3. **验证事件监听器**
   ```javascript
   // 在控制台中执行
   console.log(aeExtension.settingsManager.fieldListeners);
   ```

## 更新日志

### v2.0.0 - 快速设置功能
- ✅ 新增主面板快速设置区域
- ✅ 实现双向数据绑定机制
- ✅ 添加自动保存功能（500ms防抖）
- ✅ 更新高级设置面板标题
- ✅ 优化用户界面和交互体验
- ✅ 保持现有功能完全兼容

### 技术改进
- 扩展 `SettingsManager` 类支持字段级监听
- 添加防抖自动保存机制
- 实现嵌套对象路径解析
- 优化事件处理和错误处理
- 增强CSS样式和视觉反馈

## 开发者说明

如需进一步定制或扩展功能，请参考以下文件：

- `js/services/SettingsManager.js` - 设置管理核心逻辑
- `js/main.js` - 主应用逻辑和事件处理
- `index.html` - 界面结构和样式定义
- `js/constants/ImportSettings.js` - 设置常量和默认值

建议在修改代码前先运行测试文件 `test_quick_settings.html` 验证功能完整性。
